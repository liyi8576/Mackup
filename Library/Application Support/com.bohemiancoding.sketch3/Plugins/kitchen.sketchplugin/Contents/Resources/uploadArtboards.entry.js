!function(e){function t(t){for(var a,s,c=t[0],i=t[1],l=t[2],p=0,d=[];p<c.length;p++)s=c[p],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&d.push(r[s][0]),r[s]=0;for(a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a]);for(u&&u(t);d.length;)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,c=1;c<n.length;c++){var i=n[c];0!==r[i]&&(a=!1)}a&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var a={},r={10:0},o=[];function s(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=a,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)s.d(n,a,function(t){return e[t]}.bind(null,a));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var c=window.webpackJsonp=window.webpackJsonp||[],i=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=i;o.push([362,0]),n()}({0:function(e,t){e.exports=React},362:function(e,t,n){e.exports=n(720)},518:function(e,t,n){},720:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"involvedProjects",(function(){return Ge})),n.d(a,"createdProjects",(function(){return ze})),n.d(a,"subscribedProjects",(function(){return Ke})),n.d(a,"queryCategories",(function(){return Ye})),n.d(a,"queryAssets",(function(){return Je}));var r=n(29),o=n.n(r),s=n(9),c=n.n(s),i=n(10),l=n.n(i),u=n(11),p=n.n(u),d=n(12),f=n.n(d),m=n(6),h=n.n(m),g=(n(155),n(67)),w=n(0),y=n.n(w),v=n(8),k=n.n(v),b=n(1),C=n.n(b),E=n(47),x=n(216),S=n(25),j=n.n(S),N=(n(40),n(13)),_=n(35),P=n.n(_),I=n(3),O=n.n(I),D=n(2),U=n.n(D),R=n(142),L=n(115);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){U()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var M={image:"https://gw.alipayobjects.com/zos/antfincdn/A6udhTXG9e/done.png",description:"上传设计稿至 D-One，无缝沟通细节，创建交互原型，快速对接开发环境"},T=function(e){p()(n,e);var t=F(n);function n(e){var a;return c()(this,n),a=t.call(this,e),U()(O()(a),"onClick",P()(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{a.setState({loading:!0}),console.log("done start"),window.pluginCall("doneAuth",[{func:"authBegin"}])}catch(e){console.error(e),a.setState({loading:!1}),N.a.error("".concat(window.ks_i18n["Authorization failed, please try again"],": ").concat(e.message))}case 1:case"end":return e.stop()}}),e)})))),U()(O()(a),"openUrl",(function(e){window.pluginCall("yuqueAuth",[{func:"open",params:e}])})),a.state={loading:!1},a.doneToken=null,a.DONE_BASE_URL=L.DONE_BASE_URL,a.pollingTimes=0,a}return l()(n,[{key:"render",value:function(){var e=this,t=this.state.loading,n=this.context.track,a=q(q({},M),{},{loading:t,intro:!1,loginInfo:{text:"授权登录 D-One",onClick:function(){n({action:"授权登录 D-One"}),e.onClick()}},registerInfo:{text:"注册 D-One",onClick:function(){n({action:"注册 D-One"}),e.openUrl(e.LARK_BASE_URL)}}});return y.a.createElement(R.a,a)}}]),n}(y.a.Component);U()(T,"contextTypes",{track:C.a.func});var $=T,B=(n(46),n(18)),G=(n(134),n(43)),z=(n(160),n(45)),K=(n(31),n(5)),Y=(n(49),n(21)),J=(n(106),n(58)),V=(n(107),n(34)),W=n(57),H=n.n(W),X=n(108),Q=n.n(X),Z=n(26),ee=n.n(Z),te=n(36),ne=n.n(te),ae=n(128),re=(n(192),n(113)),oe=n(203),se=n(84),ce=n.n(se),ie=n(4),le=n.n(ie),ue=(n(518),function(e){return y.a.createElement("div",o()({},e,{className:"panel-footer"}))});ue.Left=function(e){var t=e.className,n=ce()(e,["className"]);return y.a.createElement("div",o()({},n,{className:le()("panel-footer-left","left",t)}))},ue.Right=function(e){var t=e.className,n=ce()(e,["className"]);return y.a.createElement("div",o()({},n,{className:le()("panel-footer-right","right",t)}))};var pe=ue,de=n(725),fe=Object(de.a)({scriptUrl:"https://at.alicdn.com/t/font_1920940_43h6tybuztj.js"});function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var he=pe.Left,ge=pe.Right,we=function(e){p()(n,e);var t=me(n);function n(){return c()(this,n),t.apply(this,arguments)}return l()(n,[{key:"render",value:function(){var e,t,n,a=this.props,r=a.larkUrl,o=a.exportStatus,s=a.cancelStatus,c=a.loading,i=a.onInspect,l=a.exportMessage,u=a.failMessage,p=a.errInfo,d=a.progress,f=a.isNewUser,m=a.onCancelExport,h=a.onCopyLink,g=a.previewUrl,w=a.repoType,v="active"===o?y.a.createElement(Y.a,{title:"取消上传",placement:"topLeft",arrowPointAtCenter:!0},y.a.createElement(K.a,{className:"btn-cancel-export",onClick:m,type:"close-circle",theme:"filled"})):null,k=y.a.createElement("a",{onClick:i,href:r,style:{color:f?"#1890FF":""}},f?window.ks_i18n["Go to create"]:window.ks_i18n["Current repos"],y.a.createElement(fe,{style:{marginLeft:"4px"},type:"iconlink"})),b=g?y.a.createElement("a",{onClick:i,href:g,style:{color:f?"#1890FF":""}},f?window.ks_i18n["Go to create"]:window.ks_i18n["Learn more"],y.a.createElement(fe,{style:{marginLeft:"4px"},type:"iconlink"})):y.a.createElement(y.a.Fragment,null);1===s?(e=v,n=window.ks_i18n.Canceling):2===s?(e=y.a.createElement(K.a,{type:"exclamation-circle",theme:"filled",style:{color:"#FDAF14"}}),t=window.ks_i18n["Upload canceled"]):c&&(e=y.a.createElement("div",null,v,y.a.createElement(re.a,{percent:parseInt(d,10),size:"small",status:o,showInfo:!1,style:{width:136,position:"relative",top:-1.5}})),n="".concat(l," ").concat(d,"%")),"success"===o?(e=y.a.createElement(K.a,{type:"check-circle",theme:"filled",style:{color:"#52C41A"}}),t=[window.ks_i18n.Uploaded,y.a.createElement(oe.CopyToClipboard,{text:r,onCopy:h,key:"copy"},y.a.createElement(Y.a,{title:r,arrowPointAtCenter:!0,overlayStyle:{maxWidth:"180px"}},y.a.createElement("a",{style:{marginLeft:4,marginRight:4}},"".concat(window.ks_i18n["Copy link"]," ")))),y.a.createElement(Y.a,{title:"".concat(window.ks_i18n["There may be a delay on the server side"]),overlayStyle:{maxWidth:"100px"},arrowPointAtCenter:!0},y.a.createElement(K.a,{type:"info-circle"}))]):"exception"===o&&(e=y.a.createElement(K.a,{type:"close-circle",theme:"filled",style:{color:"#F5222D"}}),t="".concat(window.ks_i18n["Upload failed"]," ").concat(u),n=b),f&&(e=y.a.createElement(K.a,{type:"info-circle",theme:"filled",style:{color:"#FAAD14"}}),t=window.ks_i18n["Yuque repos not found"],n=null);var C=p.errorCode,E="UNKNOWN ERROR";return"max_single_file_size"===C?E="文件超过 100MB 限制，升级".concat("User"===w?"语雀会员":"高级版团队","可上传最大 1GB 文件"):"max_resource_total_size"===C&&(E="语雀".concat("User"===w?"普通用户":"基础版团队","上传总量上限为10GB，\n      升级").concat("User"===w?"会员":"高级版","可享受 100GB 大容量上传")),y.a.createElement(pe,null,y.a.createElement(he,{className:"left"},e,t),y.a.createElement(Y.a,{placement:"topRight",title:g&&"success"!==o?E:null,arrowPointAtCenter:!0},y.a.createElement(ge,null,n||k)))}}]),n}(w.PureComponent),ye=n(199),ve=n(206),ke=n(14);n(68),n(251);function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var Ce=V.a.Option,Ee=V.a.OptGroup;window.pluginCall=ke.a;var xe=function(e){p()(r,e);var t,n,a=be(r);function r(e){var t;return c()(this,r),t=a.call(this,e),U()(O()(t),"onCancelExport",(function(){window.ks_export_cancel_ok=function(){t.setState({exportStatus:"active",cancelStatus:2,loading:!1})},t.setState({cancelStatus:1}),window.pluginCall("cancelExport")})),U()(O()(t),"onUpload",(function(e){e.preventDefault(),t.setState({cancelStatus:0,loading:!0,exportProgress:1,exportStatus:"active"});var n=t.state,a=n.category,r=n.group,o=n.repo,s=t.context.track;t.setLastDocument({repo:o,group:r}),setTimeout((function(){s({action:"上传画板-".concat(r,"/").concat(o)}),window.pluginCall("exportArtboards",[{category:a,group:r,repo:o}])}),200)})),U()(O()(t),"onChangeCategory",(function(e){var n=e.target.value;t.setState({category:n}),t.clearProgress(),t.syncArtboards()})),U()(O()(t),"onChangeGroup",(function(e){t.setState({group:e&&parseInt(e,10)}),t.clearProgress()})),U()(O()(t),"onChangeRepo",(function(e){t.setState({repo:e&&parseInt(e,10),group:null}),t.fetchGroupsByRepoId(e,{}),t.clearProgress()})),U()(O()(t),"onInspect",(function(e){e.preventDefault();var n=e.target.href,a=t.context.track;n&&(a({action:"打开相关链接"}),window.pluginCall("inspectLark",[n])),t.clearProgress(),t.setState({previewUrl:null})})),U()(O()(t),"onCopyLink",(function(){N.a.success(window.ks_i18n["Copy successfully"])})),U()(O()(t),"getLastDocument",(function(){window.pluginCall("getLastDocument");try{return JSON.parse(window.localStorage.getItem("current_sketch_doc"))}catch(e){return{}}})),U()(O()(t),"setLastDocument",(function(e){var t=e.repo,n=e.group;console.log("yuque set document info"),window.pluginCall("setLastDocument",[{repo:t,group:n}])})),U()(O()(t),"syncArtboards",(function(){console.log("syncArtboards from webview");var e=t.state.category;window.pluginCall("syncArtboards",[{noExportImages:"selected"===e}])})),U()(O()(t),"clearProgress",(function(){t.setState({loading:!1,exportProgress:0,exportStatus:"active"})})),U()(O()(t),"clickRefreshIcon",(function(){t.triggerMannually=!0,t.fetchRepositories()})),t.state={fetchData:[],cancelStatus:0,artboards:[],loading:!1,exportProgress:0,exportStatus:"active",exportMessage:"",category:"selected",group:null,repo:null,failMessage:"",errInfo:{},repoList:[],groupList:[],previewUrl:null,repoType:null,isNewUser:!1,fetchingRepositories:!1},t.urlMap={},window.exportProgress=je.bind(O()(t)),t.syncArtboards=H()(t.syncArtboards,100),window.syncArtboards=Ne.bind(O()(t)),t}return l()(r,[{key:"componentDidMount",value:function(){this.fetchRepositories(!0),this.syncArtboards()}},{key:"onCreateRepo",value:function(e){this.onInspect(e)}},{key:"getSelectedArtboardsCount",value:function(){return this.state.artboards.filter((function(e){return e.selected})).length}},{key:"getArtboardsCountToUpdate",value:function(){var e=this.state,t=e.category,n=e.artboards;return"selected"===t?this.getSelectedArtboardsCount():n.length}},{key:"getLarkUrl",value:function(){var e,t=this.props.LARK_BASE_URL,n=this.state,a=n.repo,r=n.exportStatus,o=n.previewUrl,s=n.group;return n.isNewUser?"".concat(t,"/new?type=Design"):(a&&(e=s?"".concat(t,"/").concat(this.urlMap[a].login,"/").concat(this.urlMap[a].slug,"/artboards/").concat(s):"".concat(t,"/").concat(this.urlMap[a].login,"/").concat(this.urlMap[a].slug)),"success"===r&&(e=o),e||t)}},{key:"fetchGroupsByRepoId",value:(n=P()(j.a.mark((function e(t,n){var a,r,o,s,c,i,l,u,p,d,f,m,h,g=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.isInit,r=this.props,o=r.pluginVersion,s=r.appVersion,c=r.login,i=r.LARK_BASE_URL,l=r.token,e.prev=2,(u=ee.a.create()).defaults.baseURL=i.replace("yuque.antfin-inc","yuque-api.antfin-inc"),u.defaults.headers.common["X-Auth-Token"]=l,e.next=8,u("".concat("/api/v2/kitchen/repos","/").concat(t).concat("/artboard_groups","?kitchen=").concat(o,"_").concat(s));case 8:if(!((p=e.sent).status>=200&&p.status<300)){e.next=17;break}d=p.data,f=[],d.data&&d.data.length&&((h=d.data).sort((function(e,t){return new Date(e.updated_at)<new Date(t.updated_at)})),h.forEach((function(e){"artboard"===e.artboard_type&&(g.doc&&g.doc.group===e.id&&(m=e.id),f.push(y.a.createElement(Ce,{key:e.id,value:e.id},e.name)))}))),this.triggerMannually&&N.a.success(window.ks_i18n["Yuque repos list updated!"]),m&&a?this.setState({groupList:f,group:m,fetchingRepositories:!1}):this.setState({groupList:f,fetchingRepositories:!1}),e.next=22;break;case 17:if(404!==parseInt(p.status,10)){e.next=21;break}throw Error(window.ks_i18n["Yuque service interface is lost, please contact the developer"]);case 21:throw Error(window.ks_i18n["Network error, please try again"]);case 22:this.triggerMannually=!1,e.next=30;break;case 25:e.prev=25,e.t0=e.catch(2),N.a.error(e.t0.message),console.error(e.t0),ae.a.report("error",{login:c,type:"webview",message:e.t0.message});case 30:case"end":return e.stop()}}),e,this,[[2,25]])}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchRepositories",value:(t=P()(j.a.mark((function e(t){var n,a,r,o,s,c,i,l,u,p,d,f,m,h,g,w,v,k,b,C,E=this;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.login,r=n.pluginVersion,o=n.appVersion,s=n.LARK_BASE_URL,c=n.token,i=this.state,l=i.repo,!i.fetchingRepositories){e.next=4;break}return e.abrupt("return");case 4:return console.log("Fetching repos"),this.setState({fetchingRepositories:!0}),e.prev=6,(u=ee.a.create()).defaults.baseURL=s.replace("yuque.antfin-inc","yuque-api.antfin-inc"),u.defaults.headers.common["X-Auth-Token"]=c,e.next=12,u("".concat("/api/v2/kitchen/repos","?kitchen=").concat(r,"_").concat(o));case 12:if(!((p=e.sent).status>=200&&p.status<300)){e.next=19;break}d=p.data,console.log(d),d.data&&d.data.length?(f=d.data,this.doc=this.getLastDocument(),h=l,g=f.map((function(e){return e.id})),w=f.filter((function(e){return e.user&&e.user.login})),v=Q()(w,(function(e){return e.user.login})),g.indexOf(l)>-1||(h=v[a]&&v[a][0].id||d.data[0].id),k=[],Object.keys(v).forEach((function(e){var t=[];v[e].forEach((function(n){E.doc&&E.doc.repo===n.id&&(m=n.id),E.urlMap[n.id]={slug:n.slug,login:n.user&&n.user.login};var a=v[e][0].user.name;t.push(y.a.createElement(Ce,{key:n.id,value:n.id,title:n.name,label:y.a.createElement("span",null,y.a.createElement(J.a,{className:"avatar",size:"small",src:v[e][0].user.avatar_url}),y.a.createElement("span",{className:"group-name",title:a},a," /")," ",n.name)},n.name))}));var n=y.a.createElement(Ee,{label:y.a.createElement("div",null,y.a.createElement(J.a,{className:"avatar",size:"small",src:v[e][0].user.avatar_url}),v[e][0].user.name),key:v[e][0].user.name},t);a!==e?k.push(n):b=n})),b&&k.unshift(b),C=t&&m?m:h,this.setState({fetchData:d.data,repoList:k,repo:C,isNewUser:!1}),this.fetchGroupsByRepoId(C,{isInit:t})):this.setState({fetchData:[],isNewUser:!0,repoList:[],repo:null,fetchingRepositories:!1}),e.next=24;break;case 19:if(404!==parseInt(p.status,10)){e.next=23;break}throw Error(window.ks_i18n["Yuque service interface is lost, please contact developers"]);case 23:throw Error(window.ks_i18n["Network error, please try again"]);case 24:e.next=31;break;case 26:e.prev=26,e.t0=e.catch(6),N.a.error(e.t0.message),console.error(e.t0),ae.a.report("error",{type:"webview",login:a,message:e.t0.message});case 31:case"end":return e.stop()}}),e,this,[[6,26]])}))),function(e){return t.apply(this,arguments)})},{key:"renderArtboards",value:function(){var e=this.state,t=e.artboards,n=e.category;return y.a.createElement("ul",{className:"artboard-list"},t.filter((function(e){return"selected"!==n||!!e.selected})).map((function(e){return y.a.createElement(Y.a,{title:e.name,key:e.id},y.a.createElement("li",{className:"artboard-item"},y.a.createElement(ve.a,{name:e.name,src:e.imagePath})))})))}},{key:"render",value:function(){var e=this.state,t=e.repo,n=e.category,a=e.loading,r=e.exportProgress,o=e.exportStatus,s=e.exportMessage,c=e.failMessage,i=e.errInfo,l=e.repoList,u=e.groupList,p=e.group,d=e.isNewUser,f=e.fetchingRepositories,m=e.cancelStatus,h=e.artboards,g=e.previewUrl,w=e.repoType,v=this.props.isInternal,k=this.getSelectedArtboardsCount(),b=this.getArtboardsCountToUpdate(),C=!(n&&t&&b>0&&!a);return y.a.createElement("div",null,!v&&y.a.createElement(ye.a,{title:window.ks_i18n["Yuque - Artboard upload"]}),y.a.createElement(z.a,{onSubmit:this.onUpload,className:"login-form",style:v?{}:{marginTop:"15px"}},y.a.createElement("div",{className:"form-item-title-wrapper"},y.a.createElement("span",{className:"form-item-title"},window.ks_i18n.Repos),y.a.createElement(Y.a,{title:window.ks_i18n["Update list"],placement:"right"},y.a.createElement(K.a,{type:f?"loading":"reload",className:"refresh",onClick:this.clickRefreshIcon}))),y.a.createElement(z.a.Item,null,y.a.createElement(V.a,{showSearch:!0,disabled:!l.length||a,value:t,placeholder:window.ks_i18n["Filter repos"],optionFilterProp:"children",optionLabelProp:"label",onChange:this.onChangeRepo,dropdownStyle:{maxHeight:276},className:"lark-repo-select",dropdownClassName:"lark-repo-dropdown",filterOption:function(e,t){return t.props.children.toLowerCase?t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0:!(!t.props.children.join||!t.props.children.join("").toLowerCase)&&t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0}},l)),y.a.createElement("div",{className:"form-item-title-wrapper"},y.a.createElement("span",{className:"form-item-title"},window.ks_i18n.Group)),y.a.createElement(z.a.Item,null,y.a.createElement(V.a,{showSearch:!0,disabled:!l.length||a,placeholder:window.ks_i18n["Filter groups"],value:p,optionFilterProp:"children",onChange:this.onChangeGroup,dropdownStyle:{maxHeight:212},filterOption:function(e,t){return t.props.children.toLowerCase?(console.log(t.props.children.toLowerCase(),e.toLowerCase()),t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0):!(!t.props.children.join||!t.props.children.join("").toLowerCase)&&t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0}},y.a.createElement(Ce,{key:1e4,value:null},y.a.createElement("span",null,window.ks_i18n["New group"],y.a.createElement(Y.a,{title:y.a.createElement("div",{dangerouslySetInnerHTML:{__html:window.ks_i18n["After 'New group' executed successfully,<br /> a new group named with current page<br /> will be created in Yuque repo"]}})},y.a.createElement(K.a,{style:{marginLeft:4},type:"question-circle-o"})))),u)),y.a.createElement(z.a.Item,{className:"artboard-select"},y.a.createElement(G.a.Group,{disabled:a,onChange:this.onChangeCategory,value:n},y.a.createElement(G.a,{value:"selected"},window.ks_i18n["Selected artboards"],y.a.createElement("span",{className:"artboard-select-count",style:{opacity:k>0?"":".5"}},"(",k,")")),y.a.createElement(G.a,{value:"all"},window.ks_i18n["All artboards in current page"],y.a.createElement("span",{className:"artboard-select-count",style:{opacity:h.length>0?"":".5"}},"(",h.length,")")))),this.renderArtboards(),y.a.createElement(z.a.Item,null,y.a.createElement(B.a,{block:!0,type:"primary",htmlType:"submit",loading:a,disabled:C,icon:"upload"},0===b?window.ks_i18n["Please select artboards"]:window.ks_i18n.Upload))),y.a.createElement(we,{larkUrl:this.getLarkUrl(),exportStatus:o,cancelStatus:m,loading:a,onInspect:this.onInspect,onCancelExport:this.onCancelExport,failMessage:c,errInfo:i,exportMessage:s,progress:r,isNewUser:d,onCopyLink:this.onCopyLink,previewUrl:g,repoType:w}))}}]),r}(y.a.Component);xe.contextTypes={track:C.a.func};var Se=z.a.create()(xe);function je(e){var t=this;console.log("upload result",e);var n,a,r,o,s=e.success,c=e.fail,i=e.percent,l=e.message,u=e.previewUrl,p=this.state,d=p.fetchData,f=p.repo,m="active",h=l,g=!0;if(s&&(setTimeout((function(){t.setState({fetchingRepositories:!1},t.fetchRepositories)}),1e3),m="success",g=!1),c&&(m="exception",g=!1,n=l),u&&"ERROR"===u.split(".")[0]){r=u.split(".")[1]?u.split(".")[1]:null,o=u.split(".")[2]?u.split(".")[2]:null;var w=d.find((function(e){return e.id===f}));u="Group"===(a=w&&w.user&&w.user.type?w.user.type:null)?"https://www.yuque.com/yuque/help/group#gbwZ7":"https://www.yuque.com/yuque/help/member-privilege"}this.setState({exportProgress:i||this.state.exportProgress,previewUrl:u,repoType:a,exportStatus:m,exportMessage:h,loading:g,failMessage:n,errInfo:{errorStatus:r,errorCode:o}})}function Ne(e){ne()(e,this.state.artboards)||this.state.loading||this.setState({artboards:e})}var _e=n(41),Pe=n.n(_e),Ie=(n(136),n(51)),Oe=(n(572),n(357)),De=n(726);window.pluginCall=ke.a;var Ue=y.a.memo((function(e){var t=e.selected,n=e.updateSelected,a=e.jump,r=Object(w.useState)([]),o=Pe()(r,2),s=o[0],c=o[1],i=Object(w.useState)(t),l=Pe()(i,2),u=l[0],p=l[1],d=Object(w.useCallback)(H()((function(){window.pluginCall("syncDoneArtboards",[])}),100),[]),f=Object(w.useCallback)((function(e){c(e)}),[c]),m=Object(w.useMemo)((function(){var e=[];return{allKeys:s.reduce((function(t,n){return t.push(n.key),n.children&&n.children.forEach((function(n){t.push(n.key),e.push(n.key)})),t}),[]),artboardsKeys:e}}),[s]),h=m.allKeys,g=m.artboardsKeys,v=Object(w.useCallback)((function(e){e.target.checked?p(h):p([])}),[p,h]),k=Object(w.useCallback)((function(){var e=u.filter((function(e){return g.includes(e)}));n(e),a(1)}),[n,u,g]),b=u.length===h.length&&0!==u.length,C=Object(w.useCallback)((function(e){p(e)}),[p]);Object(w.useEffect)((function(){window.syncArtboardsForDone=f}),[f]),Object(w.useEffect)((function(){d()}),[]);var E=Object(w.useCallback)((function(){p([]),d(),N.a.success(window.ks_i18n["Artboards list updated"])}),[n,d]);return y.a.createElement("div",{className:"done-upload done-upload-step1"},y.a.createElement("div",{className:"panel-title-wrapper"},y.a.createElement("span",{className:"panel-title"},window.ks_i18n["Please select artboards"]),y.a.createElement(Y.a,{title:window.ks_i18n["Update list"],placement:"right"},y.a.createElement(K.a,{type:"reload",className:"panel-refresh",onClick:E}))),y.a.createElement("div",{className:"panel-content"},s.length?y.a.createElement(Oe.a,{switcherIcon:y.a.createElement(De.a,null),checkable:!0,selectable:!1,defaultExpandAll:!0,onCheck:C,checkedKeys:u,treeData:s}):null),y.a.createElement(pe,{className:"panel-footer"},y.a.createElement(Ie.a,{checked:b,onChange:v},window.ks_i18n["Select all artboards"]),y.a.createElement(B.a,{type:"primary",size:"small",disabled:0===u.length,onClick:k},"下一步")))})),Re=(n(54),n(28)),Le=(n(123),n(42)),Ae=n(728),qe=n(727);function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var Me=pe.Left,Te=pe.Right,$e=function(e){p()(n,e);var t=Fe(n);function n(){return c()(this,n),t.apply(this,arguments)}return l()(n,[{key:"render",value:function(){var e,t=this.props,n=t.doneUrl,a=t.previewUrl,r=t.exportStatus,o=t.cancelStatus,s=t.loading,c=t.onInspect,i=t.exportMessage,l=t.failMessage,u=t.handleGoBack,p=t.progress,d=t.isNewUser,f=t.onCancelExport,m="active"===r?y.a.createElement(Y.a,{title:"取消上传",placement:"topLeft",arrowPointAtCenter:!0},y.a.createElement(K.a,{className:"btn-cancel-export",onClick:f,type:"close-circle",theme:"filled"})):null,h=null,g=null,w=d?y.a.createElement("a",{onClick:c,href:n,style:{color:"#1890FF"}},window.ks_i18n["Go to create"],y.a.createElement(fe,{type:"iconlink"})):null;1===o?(h=m,e=window.ks_i18n.Canceling):2===o?(h=y.a.createElement(K.a,{type:"exclamation-circle",theme:"filled",style:{color:"#FDAF14"}}),g=window.ks_i18n["Upload canceled"]):s&&(h=y.a.createElement("div",null,m,y.a.createElement(re.a,{percent:parseInt(p,10),size:"small",status:r,showInfo:!1,style:{width:136,position:"relative",top:-1.5}})),e="".concat(i," ").concat(p,"%")),"success"===r?(h=y.a.createElement(K.a,{type:"check-circle",theme:"filled",style:{color:"#52C41A"}}),g=[window.ks_i18n.Uploaded],e=y.a.createElement("a",{onClick:c,href:a}," ".concat(window.ks_i18n.Check),y.a.createElement(fe,{type:"iconlink"}))):"exception"===r&&(h=y.a.createElement(K.a,{type:"close-circle",theme:"filled",style:{color:"#F5222D"}}),g="".concat(window.ks_i18n["Upload failed"]," ").concat(l));var v=null!==h;return y.a.createElement(pe,null,y.a.createElement(Me,{className:"left",onClick:v?null:u,style:v?{}:{color:"#1890ff"}},v?h:y.a.createElement(qe.a,null),v?g:y.a.createElement("span",{style:{cursor:"pointer"}},"".concat(window.ks_i18n["Go Back"]))),y.a.createElement(Te,null,e||w))}}]),n}(w.PureComponent),Be="https://api.designer.alibaba-inc.com/done/openapi/query",Ge={request:function(e){return{url:Be,method:"post",headers:{"Content-Type":"application/json","x-auth-token":e},data:{query:"\n        query InvolvedProjects($writable: Boolean, $first: Int, $after: String, $key: String) {\n          InvolvedProjects(writable: $writable, first: $first, after: $after, key: $key) {\n            pageInfo {\n              hasNextPage\n              endCursor\n            }\n            count\n            edges {\n              node {\n                id\n                spaceId\n                spaceName\n                name\n                type\n                subscribed\n                thumbnail\n                notice\n                count\n                creator {\n                  id\n                  name\n                  avatar\n                }\n                modifier {\n                  id\n                  name\n                  avatar\n                }\n                modified\n              }\n            }\n          }\n        }\n        ",variables:{first:999,writable:!0},clientKey:"kitchen",operationName:"InvolvedProjects",date:Date.now()}}},selector:function(e){return console.log(e),e.data.InvolvedProjects.edges.map((function(e){var t=e.node;return{id:t.id,name:t.name,spaceId:t.spaceId,spaceName:t.spaceName,subscribed:t.subscribed,thumbnail:t.thumbnail}}))},initialData:[]},ze={request:function(e){return{url:Be,method:"post",headers:{"Content-Type":"application/json","x-auth-token":e},data:{query:"\n        query CreatedProjects($first: Int, $after: String) {\n          CreatedProjects(first: $first, after: $after) {\n            pageInfo {\n              hasNextPage\n              endCursor\n            }\n            count\n            edges {\n              node {\n                id\n                spaceId\n                spaceName\n                name\n                type\n                subscribed\n                thumbnail\n                notice\n                modified\n                count\n                creator {\n                  id\n                  name\n                  avatar\n                }\n                modifier {\n                  id\n                  name\n                  avatar\n                }\n              }\n            }\n          }\n        }\n        ",variables:{first:999},clientKey:"kitchen",operationName:"CreatedProjects",date:Date.now()}}},selector:function(e){return e.data.CreatedProjects.edges.map((function(e){var t=e.node;return{id:t.id,name:t.name,spaceId:t.spaceId,spaceName:t.spaceName,subscribed:t.subscribed,thumbnail:t.thumbnail}}))},initialData:[]},Ke={request:function(e){return{url:Be,method:"post",headers:{"Content-Type":"application/json","x-auth-token":e},data:{query:"\n        query SubscribedProjects($writable: Boolean, $first: Int, $after: String) {\n          SubscribedProjects(writable: $writable, first: $first, after: $after) {\n            pageInfo {\n              hasNextPage\n              endCursor\n            }\n            count\n            edges {\n              node {\n                id\n                spaceId\n                spaceName\n                name\n                type\n                subscribed\n                thumbnail\n                notice\n                modified\n                count\n                \n                creator {\n                  id\n                  name\n                  avatar\n                }\n                modifier {\n                  id\n                  name\n                  avatar\n                }\n              }\n            }\n          }\n        }\n        ",variables:{first:99,writable:!0},clientKey:"kitchen",operationName:"SubscribedProjects",date:Date.now()}}},selector:function(e){return e.data.SubscribedProjects.edges.map((function(e){var t=e.node;return{id:t.id,name:t.name,spaceId:t.spaceId,spaceName:t.spaceName,subscribed:t.subscribed,thumbnail:t.thumbnail}}))},initialData:[]},Ye={request:function(e,t){return{url:Be,method:"post",headers:{"Content-Type":"application/json","x-auth-token":e},data:{query:"\n        query Categories($projectId: ID!) {\n          Categories(projectId: $projectId) {\n            edges {\n              node {\n                id\n                name\n              }\n            }\n          }\n        }\n        ",variables:{projectId:t},clientKey:"kitchen",operationName:"Categories",date:Date.now()}}},selector:function(e){return e.data.Categories.edges.map((function(e){var t=e.node;return{id:t.id,name:t.name}}))},initialData:[]},Je={request:function(e,t,n,a){return{url:Be,method:"post",headers:{"Content-Type":"application/json","x-auth-token":e},data:{query:"\n        query QueryAssets($projectId: ID!, $categoryId: ID, $key: String, $first: Int, $last: Int, $before: String, $after: String, $order: String, $types: [String], $isExact: Boolean) {\n          Assets(projectId: $projectId, categoryId: $categoryId, key: $key, first: $first, after: $after, last: $last, before: $before, order: $order, types: $types, isExact: $isExact) {\n            edges {\n              cursor\n              node {\n                id\n                currentId\n                projectId\n                categoryId\n                name\n                modified\n                creator {\n                  name\n                }\n                isInspect\n              }\n            }\n          }\n        }\n        ",variables:{key:t,order:"custom",projectId:n,categoryId:a,types:["zip"],isExact:!0}}}},selector:function(e){var t=e.data.Assets.edges;return t.length?t[0].node:null},initialData:[]};function Ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var We=V.a.Option,He={involvedProjects:"Involved Projects",createdProjects:"Created Projects",subscribedProjects:"Subscribed Projects"},Xe=["involvedProjects","createdProjects","subscribedProjects"];window.pluginCall=ke.a;var Qe=function(e){p()(o,e);var t,n,r=Ve(o);function o(e){var t;c()(this,o),t=r.call(this,e),U()(O()(t),"setLastDocument",(function(e){var t=e.project,n=e.category;console.log("done set document info"),window.pluginCall("setLastDocumentDoneInfo",[{project:t,category:n}])})),U()(O()(t),"clearProgress",(function(){t.setState({loading:!1,exportProgress:0,exportStatus:"active"})})),U()(O()(t),"onInspect",(function(e){e.preventDefault();var n=e.target.href;n&&window.pluginCall("inspectLark",[n]),t.clearProgress(),t.setState({previewUrl:null})})),U()(O()(t),"onCancelExport",(function(){window.ks_done_export_cancel_ok=function(){t.setState({exportStatus:"active",cancelStatus:2,loading:!1})},t.setState({cancelStatus:1}),window.pluginCall("cancelDoneExport")})),U()(O()(t),"clearProgress",(function(){t.setState({loading:!1,exportProgress:0,exportStatus:"active"})})),U()(O()(t),"onCopyLink",(function(){N.a.success(window.ks_i18n["Copy successfully"])})),U()(O()(t),"handleUpload",(function(e){e.preventDefault(),console.log("---------------"),t.setState({cancelStatus:0,loading:!0,exportProgress:1,exportStatus:"active"});var n=t.state,a=n.selectedProject,r=n.selectedCategory,o=n.docName,s=n.isSketchNeedUpload,c=n.isOverwrite,i=n.sameNameFileId,l=t.props.selectedArtboards;t.setLastDocument({project:a,category:r}),setTimeout((function(){window.pluginCall("exportArtboardsToDone",[{category:r,project:a,artboards:l,fileName:o,isSketchNeedUpload:s,isOverwrite:c,sameNameFileId:i}])}),200)})),U()(O()(t),"handleJump",(function(){(0,t.props.jump)(0)})),U()(O()(t),"handleCheckChange",(function(e){t.setState({isSketchNeedUpload:e.target.checked})})),U()(O()(t),"handleOverwriteCheckChange",(function(e){t.setState({isOverwrite:e.target.checked})})),U()(O()(t),"handleChangeFileName",(function(e){t.setState({docName:e.target.value}),t.clearProgress(),t.queryAssetByFilename(e.target.value)})),U()(O()(t),"queryAssetByFilename",function(){var e=P()(j.a.mark((function e(n){var a,r,o,s,c,i,l,u;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.props.token,r=t.state,o=r.selectedProject,s=r.selectedCategory,c=r.docName,i=n||c,!o||!s){e.next=8;break}return e.next=6,ee()(Je.request(a,i,o,s));case 6:(l=e.sent).status>=200&&l.status<300&&l.data&&l.data.data&&"false"!==String(l.data.success)&&(u=Je.selector(l.data),console.log(u),u?t.setState({hasSameNameFile:!0,sameNameFileId:u.id,sameNameFileModified:u.modified}):t.setState({hasSameNameFile:!1,sameNameFileId:null,sameNameFileModified:null}));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),U()(O()(t),"handleChangeSelectedCategory",(function(e){t.setState({selectedCategory:e}),t.clearProgress()}));var n=t.props.docName;return t.state={exportMessage:"",failMessage:"",previewUrl:null,isNewUser:!1,cancelStatus:0,loading:!1,exportProgress:0,exportStatus:"active",projectType:"involvedProjects",projects:[],selectedProject:null,categories:[],selectedCategory:"noCategory",isSketchNeedUpload:!1,fetchingProjects:!1,fetchingCategories:!1,docName:n.replace(/.sketch$/,""),hasSameNameFile:!1,isOverwrite:!1,sameNameFileId:null,sameNameFileModified:null},t.fetchProjects=t.fetchProjects.bind(O()(t)),t.fetchCategories=t.fetchCategories.bind(O()(t)),t.queryAssetByFilename=H()(t.queryAssetByFilename,100),window.exportDoneProgress=et.bind(O()(t)),t}return l()(o,[{key:"componentDidMount",value:function(){this.fetchProjects("involvedProjects")}},{key:"getLastDocument",value:function(){window.pluginCall("getLastDocumentDoneInfo");try{return JSON.parse(window.localStorage.getItem("current_doc_done_info"))}catch(e){return{}}}},{key:"fetchCategories",value:(n=P()(j.a.mark((function e(t){var n,a,r,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.token,!this.state.fetchingCategories){e.next=4;break}return e.abrupt("return");case 4:return console.log("Fetching catogories"),this.setState({fetchingCategories:!0}),this.clearProgress(),e.prev=7,e.next=10,ee()(Ye.request(n,t));case 10:if(!((a=e.sent).status>=200&&a.status<300&&a.data&&a.data.data&&"false"!==String(a.data.success))){e.next=18;break}r=a.data,o=Ye.selector(r),this.setState({selectedProject:t,categories:o,selectedCategory:"noCategory",fetchingCategories:!1}),this.queryAssetByFilename(),e.next=23;break;case 18:if(404!==parseInt(a.status,10)){e.next=22;break}throw Error(window.ks_i18n["D-One service interface is lost, please contact developers"]);case 22:throw Error(window.ks_i18n["Network error, please try again"]);case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),N.a.error(e.t0.message),console.error(e.t0);case 29:case"end":return e.stop()}}),e,this,[[7,25]])}))),function(e){return n.apply(this,arguments)})},{key:"fetchProjects",value:(t=P()(j.a.mark((function e(t){var n,r,o,s,c,i,l,u,p,d,f,m,h,g,w;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.token,r=this.state,o=r.fetchingProjects,s=r.projectType,c=r.selectedProject,i=r.selectedCategory,l=t||s,!o){e.next=5;break}return e.abrupt("return");case 5:return console.log("Fetching projects"),this.setState({fetchingProjects:!0,fetchingCategories:!0}),this.clearProgress(),e.prev=8,e.next=11,ee()(a[l].request(n));case 11:if(!((u=e.sent).status>=200&&u.status<300&&u.data&&u.data.data&&"false"!==String(u.data.success))){e.next=40;break}if(p=u.data,!(d=a[l].selector(p))||!d.length){e.next=37;break}return f=d[0].id,d.some((function(e){return e.id===c}))&&(f=c),e.next=20,ee()(Ye.request(n,f));case 20:if(!((m=e.sent).status>=200&&m.status<300&&m.data&&m.data.data&&"false"!==String(m.data.success))){e.next=30;break}h="noCategory",g=m.data,(w=Ye.selector(g)).some((function(e){return e.id===i}))&&(h=i),this.setState({projectType:l,isNewUser:!1,projects:d,selectedProject:f,categories:w,selectedCategory:h,fetchingProjects:!1,fetchingCategories:!1}),this.queryAssetByFilename(),e.next=35;break;case 30:if(404!==parseInt(m.status,10)){e.next=34;break}throw Error(window.ks_i18n["D-One service interface is lost, please contact developers"]);case 34:throw Error(window.ks_i18n["Network error, please try again"]);case 35:e.next=38;break;case 37:this.setState({projectType:l,isNewUser:!0,projects:d,selectedProject:null,fetchingProjects:!1,fetchingCategories:!1,categories:[],selectedCategory:"noCategory"});case 38:e.next=45;break;case 40:if(404!==parseInt(u.status,10)){e.next=44;break}throw Error(window.ks_i18n["D-One service interface is lost, please contact developers"]);case 44:throw Error(window.ks_i18n["Network error, please try again"]);case 45:e.next=51;break;case 47:e.prev=47,e.t0=e.catch(8),N.a.error(e.t0.message),console.error(e.t0);case 51:case"end":return e.stop()}}),e,this,[[8,47]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=this.state,n=t.isNewUser,a=t.selectedProject,r=t.categories,o=t.loading,s=t.fetchingCategories,c=t.fetchingProjects,i=t.selectedCategory,l=t.projectType,u=t.projects,p=t.docName,d=t.failMessage,f=t.exportMessage,m=t.exportProgress,h=t.exportStatus,g=t.cancelStatus,w=t.previewUrl,v=t.isSketchNeedUpload,k=t.hasSameNameFile,b=t.isOverwrite,C=t.sameNameFileModified,E=!(a&&i&&p),x=this.props.baseUrl;return y.a.createElement("div",{className:"done-upload"},y.a.createElement(z.a,{className:"panel-form",onSubmit:this.handleUpload},y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement("span",{className:"panel-form-item-title"},window.ks_i18n["Project group"]),y.a.createElement(Y.a,{title:window.ks_i18n["Update list"],placement:"right"},y.a.createElement(K.a,{type:"reload",className:"panel-refresh",onClick:function(){return e.fetchProjects()}}))),y.a.createElement(z.a.Item,{className:"panel-form-input-item"},y.a.createElement(V.a,{value:l,onChange:this.fetchProjects,style:{width:"100%"}},Xe.map((function(e){return y.a.createElement(We,{key:e,value:e},"".concat(window.ks_i18n[He[e]]))})))),y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement("span",{className:"panel-form-item-title"},window.ks_i18n.Project)),y.a.createElement(z.a.Item,{className:"panel-form-input-item"},y.a.createElement(V.a,{value:a,loading:c,onChange:this.fetchCategories,style:{width:"100%"}},u.map((function(e){return y.a.createElement(We,{key:e.id,value:e.id},y.a.createElement("div",{style:{display:"flex",alignItems:"center"}},e.thumbnail?y.a.createElement(J.a,{size:16,src:e.thumbnail,style:{flex:"0 0 auto",marginRight:"6px"}}):y.a.createElement(J.a,{size:16,style:{color:"#f56a00",backgroundColor:"#fde3cf",flex:"0 0 auto",marginRight:"6px"}},e.name[0])," ".concat(e.spaceName,"/").concat(e.name)))})))),y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement("span",{className:"panel-form-item-title"},window.ks_i18n.Category)),y.a.createElement(z.a.Item,{className:"panel-form-input-item"},y.a.createElement(V.a,{value:i,loading:s,onChange:this.handleChangeSelectedCategory,style:{width:"100%"}},r.map((function(e){return y.a.createElement(We,{key:e.id,value:e.id},e.name)})))),y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement("span",{className:"panel-form-item-title"},window.ks_i18n.Filename)),y.a.createElement(z.a.Item,{className:"panel-form-input-item"},y.a.createElement(Re.a,{value:p,onChange:this.handleChangeFileName,style:{width:"100%"}})),k&&y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement(Ie.a,{checked:b,onChange:this.handleOverwriteCheckChange},"".concat(window.ks_i18n["Overwrite file with same name"],"(").concat(window.ks_i18n["Last modified"],": ").concat(C.slice(0,-5).replace("T"," "),")"))),y.a.createElement(Le.a,{className:"panel-form-item"},y.a.createElement(Ie.a,{checked:v,onChange:this.handleCheckChange},window.ks_i18n["Upload Sketch file"])),y.a.createElement(z.a.Item,{className:"panel-form-submit"},y.a.createElement(B.a,{block:!0,type:"primary",htmlType:"submit",loading:o,disabled:E,icon:y.a.createElement(Ae.a,null)},window.ks_i18n["Upload to D-One"]))),y.a.createElement($e,{doneUrl:x,exportStatus:h,cancelStatus:g,loading:o,onInspect:this.onInspect,onCancelExport:this.onCancelExport,failMessage:d,exportMessage:f,progress:m,isNewUser:n,onCopyLink:this.onCopyLink,previewUrl:w,handleGoBack:this.handleJump}))}}]),o}(y.a.PureComponent),Ze=z.a.create()(Qe);function et(e){var t=this;console.log("upload result",e);var n,a=e.success,r=e.fail,o=e.percent,s=e.message,c=e.previewUrl,i="active",l=s,u=!0;a&&(setTimeout((function(){t.setState({fetchingRepositories:!1},t.fetchRepositories)}),1e3),i="success",u=!1),r&&(i="exception",u=!1,n=s),this.setState({exportProgress:o||this.state.exportProgress,previewUrl:c,repoType:void 0,exportStatus:i,exportMessage:l,loading:u,failMessage:n,errInfo:{errorStatus:void 0,errorCode:void 0}})}var tt=y.a.memo((function(e){var t=e.token,n=e.docName,a=e.baseUrl,r=Object(w.useState)(0),o=Pe()(r,2),s=o[0],c=o[1],i=Object(w.useState)([]),l=Pe()(i,2),u=l[0],p=l[1],d=Object(w.useCallback)((function(e){p(e)}),[p]),f=Object(w.useCallback)((function(e){c(e)}),[c]);return 0===s?y.a.createElement(Ue,{selected:u,updateSelected:d,jump:f}):1===s?y.a.createElement(Ze,{selectedArtboards:u,jump:f,token:t,docName:n,baseUrl:a}):void 0})),nt=n(62);function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=h()(e);if(t){var r=h()(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return f()(this,n)}}var rt=g.a.TabPane;window.pluginCall=ke.a,window.init=function(e){var t=e.trackData,n=e.login,a=e.userId;if(window._kitchen_artboard_isInit&&window.Tracert&&window.Tracert.click("uploadArtboard.pageView",{UUID:t.cnzzUUID}),window.__WPO&&window.__WPO.setConfig({nick:n||a,sample:1,spmId:"a412.b4420",imgUrl:"http://retcode.taobao.com/r.png?"}),!window._kitchen_artboard_isInit){var r=e.isDev;(r="true"===String(r)||"1"===String(r))||Object(nt.a)(),window._kitchen_artboard_isInit=!0}console.log(e),k.a.render(y.a.createElement(st,e),document.getElementById("kitchen-plugin-root"))};var ot=function(e){p()(n,e);var t=at(n);function n(){return c()(this,n),t.apply(this,arguments)}return l()(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.isInternal,n=e.DONE_BASE_URL,a=e.docName,r=e.doneToken,s=e.login,c=e.isDoneAuthValid;return t?y.a.createElement("div",{className:"card-container"},y.a.createElement(g.a,{type:"card"},y.a.createElement(rt,{tab:window.ks_i18n["Upload to Yuque"],key:"lark"},s?y.a.createElement(Se,this.props):y.a.createElement(ct,o()({header:!1},this.props,{pluginCall:window.pluginCall,onComplete:function(){console.log("yuque....."),window.pluginCall("init")}}))),y.a.createElement(rt,{tab:window.ks_i18n["Upload to D-One"],key:"done"},c?y.a.createElement(tt,{token:r,docName:a,baseUrl:n}):y.a.createElement(it,{header:!1,pluginCall:window.pluginCall,onComplete:function(){console.log("done....."),window.pluginCall("init")}})))):s?y.a.createElement(Se,this.props):y.a.createElement(ct,o()({header:!1},this.props,{onComplete:function(){console.log("yuque....."),window.pluginCall("init")},pluginCall:window.pluginCall}))}}]),n}(y.a.PureComponent);ot.contextTypes={track:C.a.func};var st=Object(E.a)(ot,"Artboard"),ct=Object(E.a)(x.a,"Artboard"),it=Object(E.a)($,"Artboard")},8:function(e,t){e.exports=ReactDOM}});