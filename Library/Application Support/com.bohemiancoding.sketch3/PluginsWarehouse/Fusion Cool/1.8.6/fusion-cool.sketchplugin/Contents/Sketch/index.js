var that=this;function __skpm_run(key,context){that.context=context;var exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/index.js")}({"./node_modules/@skpm/timers/test-if-fiber.js":function(e,t){e.exports=function(){return"undefined"!=typeof coscript&&coscript.createFiber}},"./node_modules/@skpm/timers/timeout.js":function(e,t,n){var r,o,a=[];if(n("./node_modules/@skpm/timers/test-if-fiber.js")()){a=[];r=function(e,t,n,r,o,i,s,c,l,u,p,d){var h=a.length;return a.push(coscript.scheduleWithInterval_jsFunction((t||0)/1e3,function(){e(n,r,o,i,s,c,l,u,p,d)})),h},o=function(e){var t=a[e];t&&(t.cancel(),a[e]=void 0)}}else r=function(e,t,n,r,i,s,c,l,u,p,d,h){coscript.shouldKeepAround=!0;var f=a.length;return a.push(!0),coscript.scheduleWithInterval_jsFunction((t||0)/1e3,function(){a[f]&&e(n,r,i,s,c,l,u,p,d,h),o(f),a.every(function(e){return!e})&&(coscript.shouldKeepAround=!1)}),f},o=function(e){a[e]=!1};e.exports={setTimeout:r,clearTimeout:o}},"./node_modules/cocoascript-class/lib/index.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SuperCall=void 0,t.default=function(e){const t=e.superclass||NSObject,n=(e.className||e.classname||"ObjCClass")+NSUUID.UUID().UUIDString(),a=new Set(["className","classname","superclass"]);var i=MOClassDescription.allocateDescriptionForClassWithName_superclass_(n,t);const s=[];for(var c in e){const t=e[c];if("function"==typeof t&&"init"!==c){var l=NSSelectorFromString(c);i.addInstanceMethodWithSelector_function_(l,t)}else a.has(c)||(s.push(c),i.addInstanceVariableWithName_typeEncoding(c,"@"))}return i.addInstanceMethodWithSelector_function_(NSSelectorFromString("init"),function(){const t=o.call(this);return s.map(n=>{Object.defineProperty(t,n,{get:()=>(function(e,t){const n=MOPointer.new();return(0,r.object_getInstanceVariable)(e,t,n),n.value().retain().autorelease()})(t,n),set(e){(0,r.object_setInstanceVariable)(t,n,e)}}),t[n]=e[n]}),"function"==typeof e.init&&e.init.call(this),t}),i.registerClass()};var r=n("./node_modules/cocoascript-class/lib/runtime.js");t.SuperCall=r.SuperCall;const o=(0,r.SuperCall)(NSStringFromSelector("init"),[],{type:"@"})},"./node_modules/cocoascript-class/lib/runtime.js":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SuperCall=function(e,t,n){const o=a("objc_msgSendSuper",[{type:"^"+r},{type:":"},...t],n);return function(...t){const n=(r=this,a=this.superclass(),function e(t){if("object"!=typeof t||0==Object.keys(t).length)return t;const n=Object.keys(t)[0],r=t[n],o=MOStruct.structureWithName_memberNames_runtime(n,Object.keys(r),Mocha.sharedRuntime());return Object.keys(r).map(t=>{o[t]=e(r[t])}),o}({objc_super:{receiver:r,super_class:a}}));var r,a;const i=MOPointer.alloc().initWithValue_(n);return o(i,e,...t)}},t.CFunc=a;const r='{objc_super="receiver"@"super_class"#}';function o(e,t){const n=NSMutableDictionary.dictionary();n.o=e,Object.keys(t).map(e=>n.setValue_forKeyPath(t[e],"o."+e))}function a(e,t,n){function r(e){if(!e)return null;const t=MOBridgeSupportArgument.alloc().init();return o(t,{type64:e.type}),t}const a=MOBridgeSupportFunction.alloc().init();return o(a,{name:e,arguments:t.map(r),returnValue:r(n)}),a}t.object_getInstanceVariable=a("object_getInstanceVariable",[{type:"@"},{type:"*"},{type:"^@"}],{type:"^{objc_ivar=}"}),t.object_setInstanceVariable=a("object_setInstanceVariable",[{type:"@"},{type:"*"},{type:"@"}],{type:"^{objc_ivar=}"});!function(e,t){const n=MOBridgeSupportController.sharedController().valueForKey("symbols");if(!n)throw Error("Something has changed within bridge support so we can't add our definitions");if(null!==n[e])return;const r=MOBridgeSupportStruct.alloc().init();o(r,{name:e,type:t.type}),n[e]=r}("objc_super",{type:r})},"./package.json":function(e){e.exports=JSON.parse('{"name":"fusion-cool","description":"The Sketch plugin for Fusion Design.","version":"1.8.6","engines":{"sketch":">=3.0"},"scripts":{"prerelease":"npm run build","release":"node ./scripts/release.js","build":"npm run clean && skpm-build && npm run copy-framework","dev":"npm run clean && skpm-build && npm run copy-framework","start":"npm-run-all --parallel watch server log","3rd":"webpack --config ./webpack.config.js","watch":"skpm-build --watch","lint":"eslint src/","install":"npm run dev && skpm-link","remove-framework":"trash ./fusion-cool.sketchplugin/Contents/Resources/FusionCoolOSX.framework","copy-framework":"cp -a ./Resources/FusionCoolOSX.framework ./fusion-cool.sketchplugin/Contents/Resources/","cmake":"cd OSX && sh rebuild.sh","cmake-test":"cd OSX && sh test.sh","save-framework":"cd ./resources && trash FusionCoolOSX.framework && cp -a ../OSX/build/FusionCoolOSX.framework .","test":"skpm-test","clean":"trash fusion-cool.sketchplugin","doc":"trash .apidoc/ && jsdoc -c jsdoc.json","log":"skpm log -f","server":"http-server -p 4001 ./api-test/ -s","doc-server":"http-server -p 4002 .apidoc -s"},"watch":{"dev":["./src/**/*.js"]},"husky":{"hooks":{"pre-commit":"eslint \'src/**/*.{js,ts}\'"}},"private":true,"appcast":"https://alifd.oss-cn-hangzhou.aliyuncs.com/sketch-fusion/appcast.xml","skpm":{"name":"Fusion Cool","manifest":"src/manifest.json","main":"fusion-cool.sketchplugin","assets":["assets/**/*"]},"devDependencies":{"@skpm/builder":"^0.5.2","@skpm/test-runner":"^0.4.0","ali-oss":"^6.0.1","babel-eslint":"^8.1.1","colors":"^1.3.2","crypto":"^1.0.1","docdash":"^1.1.1","eslint":"^4.15.0","eslint-config-airbnb":"^17.1.0","eslint-config-airbnb-base":"^13.1.0","eslint-config-ali":"^3.1.0","eslint-plugin-import":"^2.8.0","eslint-plugin-jsx-a11y":"^6.1.2","eslint-plugin-react":"^7.4.0","husky":"^2.7.0","md5":"^2.2.1","npm-run-all":"^4.1.5","ora":"^3.0.0","prompt-input":"^3.0.0","semver":"^5.6.0","trash-cli":"^3.0.0","uglify-es":"^3.3.9","webpack":"^4.39.2","webpack-cli":"^3.3.7","xml2js":"^0.4.19"},"dependencies":{"cocoascript-class":"^0.1.2","murmur2js":"^1.0.0","sketchapp-json-plugin":"^0.1.2"}}')},"./src/api/3rd/cocoascript-class.js":function(module,exports){function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===_typeof(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/3-rd/cocoascript-class.js")}({"./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/index.js":function node_modules_cocoascriptClass012CocoascriptClassLibIndexJs(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SuperCall = undefined;\nexports.default = ObjCClass;\n\nvar _runtime = __webpack_require__(/*! ./runtime.js */ \"./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/runtime.js\");\n\nexports.SuperCall = _runtime.SuperCall;\n\n// super when returnType is id and args are void\n// id objc_msgSendSuper(struct objc_super *super, SEL op, void)\n\nconst SuperInit = (0, _runtime.SuperCall)(NSStringFromSelector(\"init\"), [], { type: \"@\" });\n\n// Returns a real ObjC class. No need to use new.\nfunction ObjCClass(defn) {\n  const superclass = defn.superclass || NSObject;\n  const className = (defn.className || defn.classname || \"ObjCClass\") + NSUUID.UUID().UUIDString();\n  const reserved = new Set(['className', 'classname', 'superclass']);\n  var cls = MOClassDescription.allocateDescriptionForClassWithName_superclass_(className, superclass);\n  // Add each handler to the class description\n  const ivars = [];\n  for (var key in defn) {\n    const v = defn[key];\n    if (typeof v == 'function' && key !== 'init') {\n      var selector = NSSelectorFromString(key);\n      cls.addInstanceMethodWithSelector_function_(selector, v);\n    } else if (!reserved.has(key)) {\n      ivars.push(key);\n      cls.addInstanceVariableWithName_typeEncoding(key, \"@\");\n    }\n  }\n\n  cls.addInstanceMethodWithSelector_function_(NSSelectorFromString('init'), function () {\n    const self = SuperInit.call(this);\n    ivars.map(name => {\n      Object.defineProperty(self, name, {\n        get() {\n          return getIvar(self, name);\n        },\n        set(v) {\n          (0, _runtime.object_setInstanceVariable)(self, name, v);\n        }\n      });\n      self[name] = defn[name];\n    });\n    // If there is a passsed-in init funciton, call it now.\n    if (typeof defn.init == 'function') defn.init.call(this);\n    return self;\n  });\n\n  return cls.registerClass();\n};\n\nfunction getIvar(obj, name) {\n  const retPtr = MOPointer.new();\n  (0, _runtime.object_getInstanceVariable)(obj, name, retPtr);\n  return retPtr.value().retain().autorelease();\n}\n\n//# sourceURL=webpack:///./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/index.js?")},"./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/runtime.js":function node_modules_cocoascriptClass012CocoascriptClassLibRuntimeJs(module,exports,__webpack_require__){"use strict";eval('\n\nObject.defineProperty(exports, "__esModule", {\n  value: true\n});\nexports.SuperCall = SuperCall;\nexports.CFunc = CFunc;\nconst objc_super_typeEncoding = \'{objc_super="receiver"@"super_class"#}\';\n\n// You can store this to call your function. this must be bound to the current instance.\nfunction SuperCall(selector, argTypes, returnType) {\n  const func = CFunc("objc_msgSendSuper", [{ type: \'^\' + objc_super_typeEncoding }, { type: ":" }, ...argTypes], returnType);\n  return function (...args) {\n    const struct = make_objc_super(this, this.superclass());\n    const structPtr = MOPointer.alloc().initWithValue_(struct);\n    return func(structPtr, selector, ...args);\n  };\n}\n\n// Recursively create a MOStruct\nfunction makeStruct(def) {\n  if (typeof def !== \'object\' || Object.keys(def).length == 0) {\n    return def;\n  }\n  const name = Object.keys(def)[0];\n  const values = def[name];\n\n  const structure = MOStruct.structureWithName_memberNames_runtime(name, Object.keys(values), Mocha.sharedRuntime());\n\n  Object.keys(values).map(member => {\n    structure[member] = makeStruct(values[member]);\n  });\n\n  return structure;\n}\n\nfunction make_objc_super(self, cls) {\n  return makeStruct({\n    objc_super: {\n      receiver: self,\n      super_class: cls\n    }\n  });\n}\n\n// Due to particularities of the JS bridge, we can\'t call into MOBridgeSupport objects directly\n// But, we can ask key value coding to do the dirty work for us ;)\nfunction setKeys(o, d) {\n  const funcDict = NSMutableDictionary.dictionary();\n  funcDict.o = o;\n  Object.keys(d).map(k => funcDict.setValue_forKeyPath(d[k], "o." + k));\n}\n\n// Use any C function, not just ones with BridgeSupport\nfunction CFunc(name, args, retVal) {\n  function makeArgument(a) {\n    if (!a) return null;\n    const arg = MOBridgeSupportArgument.alloc().init();\n    setKeys(arg, {\n      type64: a.type\n    });\n    return arg;\n  }\n  const func = MOBridgeSupportFunction.alloc().init();\n  setKeys(func, {\n    name: name,\n    arguments: args.map(makeArgument),\n    returnValue: makeArgument(retVal)\n  });\n  return func;\n}\n\n/*\n@encode(char*) = "*"\n@encode(id) = "@"\n@encode(Class) = "#"\n@encode(void*) = "^v"\n@encode(CGRect) = "{CGRect={CGPoint=dd}{CGSize=dd}}"\n@encode(SEL) = ":"\n*/\n\nfunction addStructToBridgeSupport(key, structDef) {\n  // OK, so this is probably the nastiest hack in this file.\n  // We go modify MOBridgeSupportController behind its back and use kvc to add our own definition\n  // There isn\'t another API for this though. So the only other way would be to make a real bridgesupport file.\n  const symbols = MOBridgeSupportController.sharedController().valueForKey(\'symbols\');\n  if (!symbols) throw Error("Something has changed within bridge support so we can\'t add our definitions");\n  // If someone already added this definition, don\'t re-register it.\n  if (symbols[key] !== null) return;\n  const def = MOBridgeSupportStruct.alloc().init();\n  setKeys(def, {\n    name: key,\n    type: structDef.type\n  });\n  symbols[key] = def;\n};\n\n// This assumes the ivar is an object type. Return value is pretty useless.\nconst object_getInstanceVariable = exports.object_getInstanceVariable = CFunc("object_getInstanceVariable", [{ type: "@" }, { type: \'*\' }, { type: "^@" }], { type: "^{objc_ivar=}" });\n// Again, ivar is of object type\nconst object_setInstanceVariable = exports.object_setInstanceVariable = CFunc("object_setInstanceVariable", [{ type: "@" }, { type: \'*\' }, { type: "@" }], { type: "^{objc_ivar=}" });\n\n// We need Mocha to understand what an objc_super is so we can use it as a function argument\naddStructToBridgeSupport(\'objc_super\', { type: objc_super_typeEncoding });\n\n//# sourceURL=webpack:///./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/runtime.js?')},"./src/3-rd/cocoascript-class.js":function src3RdCocoascriptClassJs(module,exports,__webpack_require__){eval('const ObjcClass = __webpack_require__(/*! cocoascript-class */ "./node_modules/_cocoascript-class@0.1.2@cocoascript-class/lib/index.js");\n\nmodule.exports = ObjcClass;\n\n\n//# sourceURL=webpack:///./src/3-rd/cocoascript-class.js?')}}))},"./src/api/3rd/sketchapp-json-plugin.js":function(module,exports){function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===_typeof(e)&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/3-rd/sketchapp-json-plugin.js")}({"./node_modules/_invariant@2.2.4@invariant/invariant.js":function node_modules_invariant224InvariantInvariantJs(module,exports,__webpack_require__){"use strict";eval("/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n\n\n/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */\n\nvar NODE_ENV = \"development\";\n\nvar invariant = function(condition, format, a, b, c, d, e, f) {\n  if (NODE_ENV !== 'production') {\n    if (format === undefined) {\n      throw new Error('invariant requires an error message argument');\n    }\n  }\n\n  if (!condition) {\n    var error;\n    if (format === undefined) {\n      error = new Error(\n        'Minified exception occurred; use the non-minified dev environment ' +\n        'for the full error message and additional helpful warnings.'\n      );\n    } else {\n      var args = [a, b, c, d, e, f];\n      var argIndex = 0;\n      error = new Error(\n        format.replace(/%s/g, function() { return args[argIndex++]; })\n      );\n      error.name = 'Invariant Violation';\n    }\n\n    error.framesToPop = 1; // we don't care about invariant's own frame\n    throw error;\n  }\n};\n\nmodule.exports = invariant;\n\n\n//# sourceURL=webpack:///./node_modules/_invariant@2.2.4@invariant/invariant.js?")},"./node_modules/_sketchapp-json-plugin@0.1.2@sketchapp-json-plugin/lib/index.js":function node_modules_sketchappJsonPlugin012SketchappJsonPluginLibIndexJs(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.appVersionSupported = appVersionSupported;\nexports.toSJSON = toSJSON;\nexports.fromSJSON = fromSJSON;\nexports.fromSJSONDictionary = fromSJSONDictionary;\n\nvar _invariant = __webpack_require__(/*! invariant */ \"./node_modules/_invariant@2.2.4@invariant/invariant.js\");\n\nvar _invariant2 = _interopRequireDefault(_invariant);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*\nThis is pretty simplistic at the moment, since it doesn't handle references. More work is needed to actually\n*/\n\n/*\nVersions based on discussion info: http://sketchplugins.com/d/316-sketch-version\n*/\n// Internal Sketch Version (ex: 95 => v47 and below)\nvar SKETCH_HIGHEST_COMPATIBLE_VERSION = '95';\n// External Sketch Version\nvar SKETCH_LOWEST_COMPATIBLE_APP_VERSION = '43';\n\nvar envOK = typeof MSJSONDataArchiver !== 'undefined' && typeof MSJSONDictionaryUnarchiver !== 'undefined';\n\nfunction appVersion() {\n  if (typeof NSBundle !== 'undefined') {\n    return NSBundle.mainBundle().infoDictionary().CFBundleShortVersionString;\n  } else {\n    return undefined;\n  }\n}\n\nvar _checkEnv = function _checkEnv() {\n  return (0, _invariant2.default)(envOK, 'sketchapp-json-plugin needs to run within Sketch v' + SKETCH_LOWEST_COMPATIBLE_APP_VERSION + '+. You are running ' + appVersion());\n};\n\nfunction appVersionSupported() {\n  return envOK;\n}\n\n// Converts an object, eg from context.selection into its JSON string representation\nfunction toSJSON(sketchObject) {\n  _checkEnv();\n  if (!sketchObject) {\n    return null;\n  }\n  var imm = sketchObject.immutableModelObject();\n  return MSJSONDataArchiver.archiveStringWithRootObject_error_(imm, null);\n}\n\nfunction fromSJSON(json) {\n  _checkEnv();\n  var dict = JSON.parse(json);\n  if (!dict) return null;\n  if (dict._class.length <= 0) {\n    return null;\n  }\n  return fromSJSONDictionary(dict);\n}\n\n// Takes a Sketch JSON tree and turns it into a native object. May throw on invalid data\nfunction fromSJSONDictionary(jsonTree) {\n  _checkEnv();\n  var decoded = MSJSONDictionaryUnarchiver.unarchiveObjectFromDictionary_asVersion_corruptionDetected_error(jsonTree, SKETCH_HIGHEST_COMPATIBLE_VERSION, null, null);\n  var mutableClass = decoded.class().mutableClass();\n  return mutableClass.alloc().initWithImmutableModelObject(decoded);\n}\n\n//# sourceURL=webpack:///./node_modules/_sketchapp-json-plugin@0.1.2@sketchapp-json-plugin/lib/index.js?")},"./src/3-rd/sketchapp-json-plugin.js":function src3RdSketchappJsonPluginJs(module,exports,__webpack_require__){eval('const sketchApp = __webpack_require__(/*! sketchapp-json-plugin */ "./node_modules/_sketchapp-json-plugin@0.1.2@sketchapp-json-plugin/lib/index.js");\n\nmodule.exports = sketchApp;\n\n\n//# sourceURL=webpack:///./src/3-rd/sketchapp-json-plugin.js?')}}))},"./src/api/_utils.js":function(e,t,n){function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n("./src/api/lib/murmur2js.js"),a={},i=new Map,s={normal:0,bold:.4,100:-.8,200:-.6,300:-.4,400:0,500:.23,600:.3,700:.4,800:.56,900:.62};a.sortObjectKeys=function(e){return Object.keys(e).sort().reduce(function(t,n){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){r(e,t,n[t])})}return e}({},t,{[n]:e[n]})},{})},a.hashStyle=function(e){return e?String(o(JSON.stringify(a.sortObjectKeys(e)))):"0"},a.isItalicFont=function(e){return 0!=(e.fontDescriptor().objectForKey(NSFontTraitsAttribute)[NSFontSymbolicTrait].unsignedIntValue()&NSFontItalicTrait)},a.isCondensedFont=function(e){return 0!=(e.fontDescriptor().objectForKey(NSFontTraitsAttribute)[NSFontSymbolicTrait].unsignedIntValue()&NSFontCondensedTrait)},a.weightOfFont=function(e){var t=e.fontDescriptor().objectForKey(NSFontTraitsAttribute)[NSFontWeightTrait].doubleValue();if(0===t){var n=Object.keys(s),r=String(e.fontName()).toLowerCase(),o=n.find(function(e){return r.endsWith(e)});if(o)return s[o]}return t},a.fontNamesForFamilyName=function(e){for(var t=NSFontManager.sharedFontManager(),n=NSArray.arrayWithArray(t.availableMembersOfFontFamily(e)),r=[],o=0;o<n.length;o+=1)r.push(n[o][0]);return r},a.getCached=function(e){i.get(e)},a.setCached=function(e,t){i.set(e,t)},a.FONT_STYLES={normal:!1,italic:!0,oblique:!0},a.APPLE_BROKEN_SYSTEM_FONT=".AppleSystemUIFont",a.FONT_WEIGHTS=s,e.exports=a},"./src/api/attribute.js":function(e,t,n){var r=n("./src/api/config.js"),o=r.FillTypes,a=r.BorderPositions,i={getRadius:function(e){return e.class()===MSRectangleShape?1==e.cornerRadiusString().split(";").map(Number).length?e.fixedRadius():e.cornerRadiusString().split(";").map(Number):[]},getBorders:function(e){for(var t=[],n=e.borders().objectEnumerator(),r=n.nextObject();r;){if(r.isEnabled()){var i=o[r.fillType()],s={fillType:i,position:a[r.position()],thickness:r.thickness()};switch(i){case"color":s.color=this.colorToJSON(r.color());break;case"gradient":s.gradient=this.gradientToJSON(r.gradient())}t.push(s)}r=n.nextObject()}return t},shadowToJSON:function(e){return{type:e instanceof MSStyleShadow?"outer":"inner",offsetX:e.offsetX(),offsetY:e.offsetY(),blurRadius:e.blurRadius(),spread:e.spread(),color:this.colorToJSON(e.color())}},getShadows:function(e){for(var t=[],n=e.shadows().objectEnumerator(),r=n.nextObject();r;)r.isEnabled()&&t.push(this.shadowToJSON(r)),r=n.nextObject();for(r=(n=e.innerShadows().objectEnumerator()).nextObject();r;)r.isEnabled()&&t.push(this.shadowToJSON(r)),r=n.nextObject();return t},getFills:function(e){for(var t=[],n=e.fills().objectEnumerator(),r=n.nextObject();r;){if(r.isEnabled()){var a=o[r.fillType()],i={fillType:a};switch(a){case"color":i.color=this.colorToJSON(r.color());break;case"gradient":i.gradient=this.gradientToJSON(r.gradient())}t.push(i)}r=n.nextObject()}return t},getRect:function(e){var t=e.absoluteRect();return{x:Math.round(t.x()),y:Math.round(t.y()),width:Math.round(t.width()),height:Math.round(t.height()),maxX:Math.round(t.x()+t.width()),maxY:Math.round(t.y()+t.height()),setX:function(e){t.setX(e),this.x=e,this.maxX=this.x+this.width},setY:function(e){t.setY(e),this.y=e,this.maxY=this.y+this.height},setWidth:function(e){t.setWidth(e),this.width=e,this.maxX=this.x+this.width},setHeight:function(e){t.setHeight(e),this.height=e,this.maxY=this.y+this.height}}},getTextAttrs:function(e){for(var t={},n=new RegExp('([a-z-]+)="([^"]+)"',"g"),r=new RegExp('([a-z-]+)="([^"]+)"'),o=e.match(n),a=0;a<o.length;){var i=r.exec(o[a]),s=i[1],c=i[2];t[s]=c,a+=1}return t},addText:function(){var e=MSTextLayer.new();return e.setStringValue("text"),e}};e.exports=i},"./src/api/cocoa-api.js":function(e,t){var n={openURL:function(e){var t;/^file:\/\/\//.test(e)?(t=e.replace("file:///",""),t="file:///".concat(encodeURIComponent(t))):t=e;var n=NSURL.URLWithString(t);NSWorkspace.sharedWorkspace().openURL(n)},alert:function(e){var t=e.msg,n=e.title,r=NSAlert.new();r.messageText=n||"Alert",r.informativeText=t,r.runModal()},confirm:function(e){var t=e.title,n=e.msg,r=e.cancelText,o=void 0===r?"Cancel":r,a=e.okText,i=void 0===a?"OK":a,s=NSAlert.new();return s.messageText=t||"Confirm",s.informativeText=n,s.addButtonWithTitle(i),s.addButtonWithTitle(o),s.setAlertStyle(0),s.runModal()===NSAlertFirstButtonReturn},getFonts:function(){var e=[];return NSFontManager.sharedFontManager().availableFontFamilies().forEach(function(t){e.push("".concat(t))}),e},zipFolder:function(e){var t=e.from,n=e.to,r=NSTask.alloc().init();r.setLaunchPath("/usr/bin/ditto");var o=NSMutableArray.arrayWithObject("-c");return o.addObject("-k"),o.addObject("-X"),o.addObject("--rsrc"),o.addObject(t),o.addObject(n),r.setArguments(o),r.launch(),r.waitUntilExit(),0===r.terminationStatus()},checkSketchUpadte:function(){return NSApp.delegate().checkForAndDownloadPluginUpdates(),1},openSketchAbout:function(){return NSApp.delegate().openAboutWindow(nil),1},openPluginList:function(){return MSPreferencesController.sharedController().switchToPaneWithIdentifier(MSPluginsPreferencePane.identifier()),1}};e.exports=n},"./src/api/cocoa-data.js":function(e,t){var n={jsstring2nsstring:function(e){return NSString.alloc().initWithFormat(e)},nsstring2jsnumber:function(e){return Number(this.nsstring2jsstring(e))},nsstring2jsstring:function(e){return"".concat(e)},nsstring2nsdata:function(e){return e.dataUsingEncoding(NSUTF8StringEncoding)},nsdata2nsstring:function(e){return NSString.alloc().initWithData_encoding(e,NSUTF8StringEncoding)},nsdata2base64string:function(e){return e.base64Encoding()},base64tonsdata:function(e){var t=NSData.alloc().initWithBase64EncodedString_options(e,0);return NSString.alloc().initWithData_encoding(t,NSUTF8StringEncoding)},jsstring2base64:function(e){var t=this.jsstring2nsstring(e),n=this.nsstring2nsdata(t),r=this.nsdata2base64string(n);return this.nsstring2jsstring(r)},nsarray2jsarray:function(e){for(var t=[],n=0;n<e.count();)t.push("".concat(e[n])),n+=1;return t},nsdict2nsstring:function(e){var t=NSJSONSerialization.dataWithJSONObject_options_error(e,0,null);return NSString.alloc().initWithData_encoding(t,NSUTF8StringEncoding)},nsdict2json:function(e){var t=this.nsdict2nsstring(e),n=this.nsstring2jsstring(t);return JSON.parse(n)}};e.exports=n},"./src/api/color.js":function(e,t){var n={colorStopToJSON:function(e){return{color:this.colorToJSON(e.color()),position:e.position()}},colorToJSON:function(e){return{r:Math.round(255*e.red()),g:Math.round(255*e.green()),b:Math.round(255*e.blue()),a:e.alpha(),"color-hex":"".concat(e.immutableModelObject().stringValueWithAlpha(!1)," ").concat(Math.round(100*e.alpha()),"%"),"argb-hex":this.colorToARGB(e),"css-rgba":"rgba(".concat([Math.round(255*e.red()),Math.round(255*e.green()),Math.round(255*e.blue()),Math.round(100*e.alpha())/100].join(","),")"),"ui-color":"(".concat(["r:".concat((Math.round(100*e.red())/100).toFixed(2)),"g:".concat((Math.round(100*e.green())/100).toFixed(2)),"b:".concat((Math.round(100*e.blue())/100).toFixed(2)),"a:".concat((Math.round(100*e.alpha())/100).toFixed(2))].join(" "),")")}},colorToARGB:function(e){var t="".concat(e.immutableModelObject().stringValueWithAlpha(!1)).replace(/#/,""),n=e.alpha(),r=(255*Number(n)).toString(16);return"#".concat(r).concat(t)},hexToRgb:function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:this.toHex(t[1]),g:this.toHex(t[2]),b:this.toHex(t[3])}:null},toHex:function(e){var t=parseInt(e,16);return 1==t.length?"0".concat(t):t},colorToMSColor:function(e){return MSImmutableColor.colorWithSVGString(e).newMutableCounterpart()},rgbaToMSColor:function(e){var t=e.r,n=e.g,r=e.b,o=e.a;return MSColor.colorWithRed_green_blue_alpha(t,n,r,o)}};e.exports=n},"./src/api/config.js":function(e,t){e.exports={GradientTypes:["linear","radial","angular"],BorderPositions:["center","inside","outside"],FillTypes:["color","gradient"]}},"./src/api/document.js":function(e,t,n){var r=n("sketch"),o=r.Artboard,a=r.Rectangle,i=r.Shape,s=r.Group,c={getDocumentID:function(){return"".concat(this.getDocument().documentData().objectID())},getSketchFileURL:function(){return decodeURIComponent("".concat(this.getDocument().fileURL()))},getFileName:function(){return this.getSketchFileURL().split("/").pop()},getSketchFileName:function(){return this.getSketchFileURL().split("/").pop().replace(/\.sketch/i,"")},isSymbolPage:function(e){var t=this.getDocument().documentData().symbolsPage();return!!t&&(!(!e||!e.class||e.class()!==MSPage)&&t.objectID()===e.objectID())},getSketchPagesArtboards:function(){var e=this,t=this.getPages();if(!t||!t.length)return[];var n=[];return t.forEach(function(t){var r=[],o={name:"".concat(t.name()),id:"".concat(t.objectID()),type:"normal",artboards:r};if(e.isSymbolPage(t)&&(o.type="symbolPage"),t.artboards){var a=t.artboards();a&&a.length&&a.forEach(function(e){r.unshift({name:"".concat(e.name()),id:"".concat(e.objectID())})})}n.push(o)}),n},createArtboard:function(e){var t=e.name,n=e.parent,r=e.x,i=e.y,s=e.width,c=e.height,l={name:t||"".concat(+new Date),x:r||0,y:i||0,width:s||400,height:c||400,parent:n||this.getPage()};return new o({name:l.name,parent:l.parent,frame:new a(l.x,l.y,l.width,l.height)})},createShapeLayer:function(){return new i({name:"S1",parent:this.getArtboard(),frame:new a(0,0,100,100)})},createGroup:function(){return new s({name:"Group",parent:this.getArtboard(),frame:new a(0,0,100,100)})}};e.exports=c},"./src/api/file.js":function(e,t){var n={writeFile:function(e){var t=e.text,n=e.filepath,r=n.split("/");r.pop(),r=r.join("/"),NSFileManager.defaultManager().createDirectoryAtPath_withIntermediateDirectories_attributes_error(r,!0,nil,nil);var o=MOPointer.alloc().init();NSString.stringWithString(t).writeToFile_atomically_encoding_error(n,!1,4,o)},readFile:function(e){return this.isFileExists(e)?String(NSString.alloc().initWithContentsOfFile_encoding_error(e,NSUTF8StringEncoding,null)).toString():null},isFileExists:function(e){return NSFileManager.defaultManager().fileExistsAtPath(e)},exportSketchToFile:function(e){var t=Object.assign({layer:"",path:"",scale:1,name:"",prefix:"",suffix:"",format:"png",subPath:"preview/"},e);if(!t.layer||!t.path||!t.name)return this.logError("writeImageFile: ".concat(JSON.stringify(e))),"";var n=MSExportRequest.exportRequestsFromExportableLayer(t.layer).firstObject(),r=[];n.scale=t.scale,n.format=t.format,r.push(t.path,t.subPath,t.prefix,t.name,t.suffix,".",t.format);var o=r.join("");return this.logInfo("writeImageFile::savePath: ".concat(o)),this.getDocument().saveArtboardOrSlice_toFile(n,o),o},deleteFolder:function(e){return this.isFileExists(e)?NSFileManager.defaultManager().removeItemAtPath_error(e,nil):(this.logInfo("deleteFolder:filepath not found:".concat(e)),0)}};e.exports=n},"./src/api/html2sketch.js":function(e,t,n){var r=n("./src/api/3rd/sketchapp-json-plugin.js"),o=n("./src/api/_utils.js"),a=o.hashStyle,i=o.getCached,s=o.setCached,c=o.fontNamesForFamilyName,l=o.weightOfFont,u=o.isItalicFont,p=o.isCondensedFont,d=o.FONT_WEIGHTS,h=o.APPLE_BROKEN_SYSTEM_FONT,f=o.FONT_STYLES,g=r.toSJSON,m={getSVGSketchJSONString:function(e){var t=e.rawSVGString,n=e.frame,r=e.viewBox,o=e.borderLeftWidthFloat,a=void 0===o?0:o,i=e.borderTopWidthFloat,s=void 0===i?0:i,c=NSString.stringWithString(t).dataUsingEncoding(NSUTF8StringEncoding),l=MSSVGImporter.svgImporter(),u=null;try{l.prepareToImportFromData(c),u=l.importAsLayer()}catch(e){this.logError("getSVGSketchJSONString: SVG import failed: ".concat(e))}if(null===u)return null;var p=Math.min(n.width/r.width,n.height/r.height);1!==p&&u.multiplyBy(p);var d=u.rect().size;NSBundle.mainBundle().infoDictionary().CFBundleShortVersionString.UTF8String()<55?(u.rect={origin:{x:n.x,y:n.y},size:{width:n.width,height:n.height}},u.layers()[0].rect={origin:{x:(n.width-d.width)/2-r.x*p,y:(n.height-d.height)/2-r.y*p},size:{width:d.width,height:d.height}}):u.rect={origin:{x:n.x+(n.width-d.width)/2+a,y:n.y+(n.height-d.height)/2+s},size:{width:d.width,height:d.height}};var h=g(u);return"".concat(h)},makeImageDataFromUrl:function(e){var t,n,r=this.httpGetData(e);if(r){var o=r.subdataWithRange(NSMakeRange(0,1)).description();if("<ff>"!=o&&"<89>"!=o&&"<47>"!=o&&"<49>"!=o&&"<4d>"!=o&&"<3c>"!=o)r=null;else if("<3c>"==o)return{isSVGImage:!0,SVGString:"".concat(NSString.alloc().initWithData_encoding_(r,NSUTF8StringEncoding))}}if(r)t=NSImage.alloc().initWithData(r);else{t=NSImage.alloc().initWithContentsOfURL(NSURL.URLWithString("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mM8w8DwHwAEOQHNmnaaOAAAAABJRU5ErkJggg=="))}var a={data:(n=void 0!==MSImageData.alloc().initWithImage_convertColorSpace?MSImageData.alloc().initWithImage_convertColorSpace(t,!1):MSImageData.alloc().initWithImage(t)).data().base64EncodedStringWithOptions(NSDataBase64EncodingEndLineWithCarriageReturn),sha1:n.sha1().base64EncodedStringWithOptions(NSDataBase64EncodingEndLineWithCarriageReturn)};return a.data="".concat(a.data),a.sha1="".concat(a.sha1),a},findFontName:function(e){var t=this.findFont(e),n=t.font,r=t.failed;return{fontName:"".concat(n.fontDescriptor().postscriptName()),failed:r}},findFont:function(e){var t=a(e),n=i(t);if(n)return n;var r=NSFont.systemFontOfSize(14).familyName(),o=NSFontWeightRegular,g=e.fontSize?e.fontSize:14,m=e.fontWeight?d[e.fontWeight]:o,S=r==h?"Helvetica":r,b=!1,y=!1;e.fontFamily&&(S=e.fontFamily),e.fontStyle&&(b=f[e.fontStyle]||!1);var v=!1;if((S===r||"System"===S)&&(n=NSFont.systemFontOfSize_weight(g,m))&&(v=!0,b||y)){var w=n.fontDescriptor(),_=w.symbolicTraits();b&&(_|=NSFontItalicTrait),y&&(_|=NSFontCondensedTrait),w=w.fontDescriptorWithSymbolicTraits(_),n=NSFont.fontWithDescriptor_size(w,g)}var j=c(S),N=!1;v||0!==j.length||((n=NSFont.fontWithName_size(S,g))?(S=n.familyName(),m=e.fontWeight?m:l(n),b=e.fontStyle?b:u(n),y=p(n)):(N=!0,n=NSFont.systemFontOfSize_weight(g,m)));for(var O=1/0,k=0;k<j.length;k+=1){var x=NSFont.fontWithName_size(j[k],g);if(b===u(x)&&y===p(x)){var F=l(x);Math.abs(F-m)<Math.abs(O-m)&&(n=x,O=F)}}return n||j.length>0&&(n=NSFont.fontWithName_size(j[0],g)),n&&s(t,{font:n,failed:N}),{font:n,failed:N}}};e.exports=m},"./src/api/image.js":function(e,t){var n=this,r={insertImageByUrl:function(e){var t=this.getSelected();return t&&t.length?this.insertImageByUrl_Layers(e,t):(this.logError("insertImageByUrl: no shapes selected"),0)},insertImageByUrl_Layers:function(e,t){var n=this,r=this.httpGetData(e),o=NSImage.alloc().initWithData_(r);return t.forEach(function(e){"".concat(e.class()).toLowerCase().indexOf("shape")>-1&&n.insertImageToShape(e,o)}),r=null,null},insertImageToShape:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=MSImageData.alloc().initWithImage(t),o=e.style();o.fills().firstObject().setFillType(4),o.fills().firstObject().setImage(r),o.fills().firstObject().setPatternFillType(n)},getLayerImgData:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"svg",o=(arguments.length>2?arguments[2]:void 0)||n.getDocument();if(MSExportRequest.exportRequestsFromExportableLayer)(t=MSExportRequest.exportRequestsFromExportableLayer(e).firstObject()).setScale(1);else{var a=e.absoluteInfluenceRect();(t=MSExportRequest.requestWithRect_sacle(a,1)).configureForLayer(e)}t.setSaveForWeb(!0);var i=NSProcessInfo.processInfo().globallyUniqueString(),s="Layer-export-".concat(e.objectID(),"__").concat(i,".").concat(r),c=NSTemporaryDirectory().stringByAppendingPathComponent(s);return o.saveArtboardOrSlice_toFile(t,c),NSData.dataWithContentsOfFile(c).base64EncodedStringWithOptions(0)}};e.exports=r},"./src/api/index.js":function(e,t,n){var r=n("sketch"),o=n("./src/api/layer.js"),a=n("./src/api/cocoa-data.js"),i=n("./src/api/cocoa-api.js"),s=n("./src/api/file.js"),c=n("./src/api/util.js"),l=n("./src/api/mocha.js"),u=n("./src/api/image.js"),p=n("./src/api/document.js"),d=n("./src/api/color.js"),h=n("./src/api/attribute.js"),f=n("./src/api/react2sketch.js"),g=n("./src/api/sketch-data.js"),m=n("./src/api/sketch-measure.js"),S=n("./src/api/logger.js"),b=n("./src/api/html2sketch.js"),y=n("./src/api/nspanel.js"),v=r.Settings,w={messageHandler:null},_={Layer:o,CocoaData:a,File:s,Util:c,MOcha:l,Images:u,Document:p,Color:d,Attribute:h,React2Sketch:f,SketchData:g,CocoaAPI:i,SketchMeasure:m,Logger:S,HTML2Sketch:b,Panel:y},j={__getDocument:function(){return MSDocument.currentDocument()||NSDocumentController.sharedDocumentController().currentDocument()||MSDocument.alloc().init()},getDocuments:function(){var e=[];return r.getDocuments().forEach(function(t){t.sketchObject&&e.push(t.sketchObject)}),e},getDocument:function(){return this.getDocuments()[0]},getPages:function(){var e=this.getDocument();return!!e&&e.pages()},getPage:function(){var e=this.getDocument();return!!e&&e.currentPage()},getArtboards:function(){var e=this.getDocument();return!!e&&e.artboards()},getArtboard:function(){var e=this.getPage();return!!e&&e.currentArtboard()},getLayers:function(){var e=this.getDocument();if(!e)return!1;var t=e.selectedLayers().layers();return!(!t||!t.length)&&t},getLayer:function(){var e=this.getLayers();return!(!e||!e.length)&&e[0]},getData:function(e){var t=v.settingForKey(e);return t?"".concat(t):""},setData:function(e){var t=e.key,n=e.value;return v.setSettingForKey(t,n),1},showMessage:function(e){var t=this.getDocument();t&&t.showMessage(e)},setMessageHandler:function(e){w.messageHandler=e},getMessageHandler:function(){return w.messageHandler}};Object.keys(_).map(function(e){return Object.assign(j,_[e])}),e.exports=j},"./src/api/layer.js":function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("sketch"),a=o.Text,i=o.Rectangle,s={layer2json:function(e){var t=MSJSONDataArchiver.archiveStringWithRootObject_error(e.immutableModelObject(),nil);return"".concat(t)},layer2file:function(e,t){var n=this.getCurrentDocument();if(n){var r=MSExportRequest.exportRequestsFromExportableLayer(e).firstObject(),o=e.objectID(),a="".concat(t,"/").concat(o,".png");n.saveArtboardOrSlice_toFile(r,a)}},currentLayerToJSON:function(){var e=this.getLayer();return e?this.layer2json(e):"[ERROR]currentLayerToJSON(); no layer selected!"},getLayerExportOptions:function(e){return e.exportOptions().exportFormats()[0]},isLayerExportable:function(e){return e.isLayerExportable()},hasExportOptions:function(e){return e.exportOptions().exportFormats().count()>0},queryLayerByID:function(e){var t=this.getDocument();return!!t&&t.documentData().layerWithID(e)},getArtboardOfLayer:function(e){return e.parentArtboard()},getPageOfLayer:function(e){return e.parentPage()},getLayerRect:function(e){if(!e)return"[ERROR]getLayerRect(layer); no layer selected!";var t=e.frame();return{x:t.x(),y:t.y(),width:t.width(),height:t.height()}},getCurrentLayerRect:function(){var e=this.getLayer();return e?this.getLayerRect(e):0},getLayerCss:function(e){return e?e.CSSAttributes():0},getCurrentLayerCss:function(){return this.getLayerCss(this.getLayer())},selectLayerByID:function(e){var t=this.queryLayerByID(e);return t&&t.select_byExpandingSelection(!0,!1),1},removeLayerByID:function(e){var t=this.queryLayerByID(e);this.removeLayer(t)},removeLayer:function(e){if(e&&e.parentGroup){var t=e.parentGroup();t&&t.removeLayer&&t.removeLayer(e)}},removeCurrentLayer:function(){var e=this.getLayer();this.removeLayer(e)},createTextLayer:function(e){var t=e.txt,n=e.x,r=e.y,o=e.color,s=e.size,c=e.weight,l=e.family,u=e.alignment,p=e.parent;new a({text:t,frame:new i(n||0,r||0,10,10),alignment:u||"left",parent:p||this.getPage(),style:{textColor:o||"#000",fontFamily:t||l,fontSize:s||30,fontWeight:c||6,borders:[]}}).adjustToFit()},getSketchSelections:function(){var e=this,t=this.getSelected(),n=[];return t&&t.length&&t.forEach(function(t){var r=t.frame(),o={name:"".concat(t.name()),id:"".concat(t.objectID()),type:"".concat(t.class()),width:Number("".concat(r.width())),height:Number("".concat(r.height()))},a=e.getLayerData("FusionCool");if(a)o.userData=a;else{var i=e.getLayerData("fusioncool-store-chart");o.userData=i}n.push(o)}),n},getSelected:function(){return this.getLayers()},hasSelected:function(){var e=this.getSelected();return!(!e||!e.length)},getLayer:function(){var e=this.getSelected();return e&&e.length?e[0]:0},setCurrentLayerStyle:function(e){var t=this.getLayer(),n=Object.assign(e);if(!t||!n)return this.logError("setCurrentLayerStyle: no data or no selection"),0;var o=t.style();if(n.fillColor){var a=MSImmutableColor.colorWithSVGString(n.fillColor);o.fills().firstObject().setColor(a)}n.borderWidth&&((o.firstEnabledBorder()||o.addStylePartOfType(1)).thickness=Number(n.borderWidth));if(n.borderColor){var i=o.firstEnabledBorder()||o.addStylePartOfType(1),s=MSImmutableColor.colorWithSVGString(n.borderColor).newMutableCounterpart();i.color=s}if(n.shadow){var c=o.firstEnabledShadow(),l=n.shadow.trim().split(" ");l.push(l.splice(4).join("")),c.offsetY=parseFloat(l[1],10),c.blurRadius=parseFloat(l[2],10),c.spread=parseFloat(l[3],10),c.color=MakeMSColor(l[4])}if(n.borderRadius){if(r(n.borderRadius)&&n.borderRadius.indexOf("%")){var u=Number(n.borderRadius.replace(/\D/g,""))/100,p=t.frame(),d=Number("".concat(p.width())),h=Number("".concat(p.height())),f=Math.max(d,h);n.borderRadius=parseFloat(f*u)}t.cornerRadiusFloat=n.borderRadius}if(n.color){var g=MSImmutableColor.colorWithSVGString(n.color);t.setTextColor(g)}return n.fontSize&&t.setFontSize(n.fontSize),n.linHeight&&t.setLineHeight(n.lineHeight),0},setLayerData:function(e){var t=e.key,n=e.value,r=this.getLayer();return r?(o.Settings.setLayerSettingForKey(r,t,n),this.getLayerDataFromNameSpace(t)&&this.setLayerDataFromNameSpace({key:t,value:""}),1):0},getLayerData:function(e){var t=this.getLayer();if(!t)return 0;var n=this.getLayerDataFromNameSpace(e);if(n)return n;var r=o.Settings.layerSettingForKey(t,e);return r||0},getLayerDataFromNameSpace:function(e){var t=this.getLayer();if(!t)return 0;var n=context.command.valueForKey_onLayer_forPluginIdentifier(e,t,"design.fusion.cool");if(n){var r;try{r=JSON.parse("".concat(n))}catch(e){log(e)}return r||"".concat(n)}return n},setLayerDataFromNameSpace:function(e){var t=e.key,n=e.value,r=this.getLayer();if(!r)return 0;return context.command.setValue_forKey_onLayer_forPluginIdentifier(n,t,r,"design.fusion.cool"),1},updateLayerData:function(e){var t=e.key,n=e.value;if(!this.getLayer())return 0;if("string"==typeof n)try{n=JSON.parse(n)}catch(e){this.logError("updateLayerData: ".concat(JSON.stringify(e)))}var r=this.getLayerData(t);if(r){var o=this.jsonExtend({from:n,to:r});this.setLayerData({key:t,value:o})}else this.setLayerData({key:t,value:n});return 1}};e.exports=s},"./src/api/lib/murmur2js.js":function(e,t){e.exports=function(e){for(var t,n=e.length,r=n,o=0;n>=4;)t=1540483477*(65535&(t=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(t>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^(t=1540483477*(65535&(t^=t>>>24))+((1540483477*(t>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}},"./src/api/lib/timeout.js":function(e,t){var n=[];e.exports={setTimeout:function(e,t,r,o,a,i,s,c,l,u,p,d){var h=n.length;return n.push(coscript.scheduleWithInterval_jsFunction((t||0)/1e3,function(){e(r,o,a,i,s,c,l,u,p,d)})),h},clearTimeout:function(e){var t=n[e];t&&(t.cancel(),n[e]=void 0)}}},"./src/api/logger.js":function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=!0,o=function(e){var t;return"object"===n(e)&&e?e.constructor&&(e&&e.class?t="<".concat(e.class(),"> ").concat(e):e&&e.constructor===Array?t="<Array> ".concat(JSON.stringify(e)):e&&e.constructor===Object&&(t="<Object> ".concat(JSON.stringify(e)))):t="number"==typeof e?"<Number> ".concat(e):"string"==typeof e?"<String> ".concat(e):"<".concat(n(e),"> ").concat(e),t||e},a={logWriteFile:function(e){ICSLog.sharedInstance().logToFile(e)},timeFormat:function(){var e=new Date,t=e.getFullYear(),n=e.getMonth(),r=e.getDate(),o=e.getHours(),a=e.getMinutes(),i=e.getSeconds();return n=n>10?n:"0".concat(n),r=r>10?r:"0".concat(r),o=o>10?o:"0".concat(o),a=a>10?a:"0".concat(a),i=i>10?i:"0".concat(i),"".concat(t,"/").concat(n,"/").concat(r," ").concat(o,":").concat(a,":").concat(i)},log:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=e.type,n=e.content;if(r){var a;switch(t){case"[SUCCESS]":a="[32m ".concat(this.timeFormat()," ").concat(t," ").concat(o(n));break;case"[ERROR]":a="[31m ".concat(this.timeFormat()," ").concat(t," ").concat(o(n));break;case"[INFO]":default:a="[36m ".concat(this.timeFormat()," ").concat(t||"[INFO]"," ").concat(o(n))}log(a),this.logWriteFile(n)}}),logSuccess:function(e){return this.log({type:"[SUCCESS]",content:e}),null},logInfo:function(e){return this.log({type:"[INFO]",content:e}),null},logError:function(e){return this.log({type:"[ERROR]",content:e}),null}};e.exports=a},"./src/api/mocha.js":function(e,t){var n={loadFramework:function(e){var t=e.frameworkName,n=void 0===t?"FusionCoolOSX":t,r=e.frameworkPath;if("undefined"==typeof ICSRequest){var o=Mocha.sharedRuntime(),a=r||this.getResourcePath();this.removeQuarantineFlag(a);var i=o.loadFrameworkWithName_inDirectory_(n,a);return this.logInfo("fpath: ".concat(a)),i?this.logInfo("加载Framework成功！"):this.logError("加载Framework失败!"),i}return 1},removeQuarantineFlag:function(e){var t=["-r","-d","com.apple.quarantine",e];NSTask.launchedTaskWithLaunchPath_arguments("/usr/bin/xattr",t).waitUntilExit()},httpGet:function(e){if(!e)return"[ERROR]httpGet(url:string) url should not be empty!";this.loadFramework({});var t=ICSRequest.sharedInstance().GET_setTimeout(e,10);return"".concat(t.body)},httpGetData:function(e){return this.loadFramework({}),ICSRequest.sharedInstance().GetData_setTimeout(e,"10").body},httpHead:function(e){var t=e.url,n=e.delay,r=void 0===n?"1":n;this.loadFramework({});var o,a=ICSRequest.sharedInstance().HEAD_setTimeout(t,r),i=this.nsdict2nsstring(a);try{o=JSON.parse(i)}catch(e){this.logError("httpHead Error: ".concat(e))}return o},buildIcsParam:function(e){var t=e.settings,n=e.sKey;this.loadFramework({});var r=ICSAuth.sharedInstance().getIcsParam_key(t,n);return"".concat(r)},httpPOSTBody:function(e){var t=e.url,n=e.settings;this.loadFramework({}),log("httpPOSTBody - start"),log(n),log("httpPOSTBody - end");var r=ICSRequest.sharedInstance().POST_setTimeout_withHeaders_withParameters(t,"".concat(n.timeoutSec||5),n.headers,n.body);return r&&!r.body&&(this.logError("httpPOSTBody: ".concat(t)),this.logError(n),this.logError(r)),"".concat(r.body)},httpUpload:function(e){this.loadFramework({});var t=Object.assign({},e);t.timeout=t.timeout||"600";var n=ICSHttp.alloc().init().upload(t);return"".concat(n)},uploadFileToOss:function(e){var t=e.objectKey,n=e.filepath,r=e.ossConfig;this.loadFramework({});var o=r.AccessKeyId,a=r.AccessKeySecret,i=r.SecurityToken,s=r.bucketName,c=ICSOss.sharedInstance();return c.createClient({AccessKeyId:o,AccessKeySecret:a,SecurityToken:i})?c.uploadFile({objectKey:t,filepath:n,bucketName:s}):(this.logError("uploadFileToOss: oss.createClient fail"),!1)},getMaterialParams:function(e){this.loadFramework({});var t=ICSAuth.sharedInstance().getMaterialParam(e);return"".concat(t)},logWriteFile:function(e){this.loadFramework({}),ICSLog.sharedInstance().logToFile(e)},xml2json:function(e){this.loadFramework({});var t=ICSRequest.sharedInstance().xml2json(e);return"".concat(t)},isAlibabaNet:function(){var e=this.httpHead({url:"https://fusion.alibaba-inc.com"});return e&&200===e.statusCode},checkFusionCoolVersion:function(){var e,t=this,n=this.httpGetData("https://alifd.oss-cn-hangzhou.aliyuncs.com/sketch-fusion/appcast.xml");if(!n)return!0;try{e=this.xml2json(n),e=JSON.parse(e);var r="0.0.1";e.rss.channel.item.forEach(function(e){var n=e.enclosure["sparkle:version"];t.versionCompare({version1:n,version2:r})>0&&(r=n)});var o=this.getPluginVersion();return this.versionCompare({version1:o,version2:r})>=0?1:0}catch(e){this.logError(e)}return 1}};e.exports=n},"./src/api/nspanel.js":function(e,t,n){var r=n("./src/api/3rd/cocoascript-class.js").default,o={createSettingsPanel:function(){var e=r({superclass:NSPanel,init2:function(){this.setDelegate(this);var e=NSButton.alloc().initWithFrame(NSMakeRect(170,40,150,100));e.title="Connect",e.bezelStyle=NSRoundedBezelStyle,this.contentView().addSubview(e)},"windowWillClose:":function(){NSApplication.sharedApplication().stopModal()}}),t=NSMakeRect(0,0,500,300),n=NSTitledWindowMask+NSClosableWindowMask,o=NSBackingStoreBuffered,a=e.alloc().initWithContentRect_styleMask_backing_defer(t,n,o,!0);a.init2(),NSApplication.sharedApplication().runModalForWindow(a),a.autorelease()}};e.exports=o},"./src/api/react2sketch.js":function(e,t,n){(function(t){function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=null,a=null,i=null,s={render:function(e){var t;if(/^<svg\b/i.test(e))t=this.renderFromSVG(e);else if("string"==typeof e){var n=JSON.parse(e);if("string"==typeof n&&(n=JSON.parse(n)),!n._class)return 0;t=this.renderFromSketchJSON(n)}else"object"==r(e)&&e._class&&(t=this.renderFromSketchJSON(e));var o=this.getLayer();if(!o)return this.logError("render: not layer selected"),0;o.removeAllLayers();var s=t.layers(),c=t.frame().width(),l=t.frame().height();return o.frame().setWidth(c),o.frame().setHeight(l),o.addLayers(s),a&&(a.name&&(o.name=a.name),this.setLayerData({key:"FusionCool",value:a}),a=null),i&&(i.name?o.name=i.name:o.name="BizChart",this.setLayerData({key:"fusioncool-store-chart",value:i}),i=null),0},beforeRender:function(e){var n=this;return e.string&&(o=e.string,e.dataset&&(a=e.dataset),e.bizchartData&&(i=e.bizchartData),t(function(){var e=n.getSelected();if(e&&e.length){var t=e[0];n.isPlaceholderLayer(t)&&n.renderConfirm()}})),0},isPlaceholderLayer:function(e){if(!e)return!1;if(!e.layers||2!==e.layers().length)return!1;var t=!1;return e.layers().forEach(function(e){t||"loading"==="".concat(e.name())&&(t=!0)}),t&&"".concat(0===e.name().indexOf("FC_"))},renderConfirm:function(){if(o){try{this.render(o)}catch(e){this.logError("renderConfirm: ".concat(JSON.stringify(e)))}o=null}return 0},renderSync:function(e){return e.bizchartData&&(i=e.bizchartData),e.dataset&&(a=e.dataset),e.string&&this.render(e.string),0},handlerSvgMagicRules:function(){var e=this.getDocument().selectedLayers();if(1===e.containedLayersCount()&&"MSLayerGroup"==(e=e.layerAtIndex(0)).class()&&(1===e.layers().length||2===e.layers().length&&"loading"==e.layers()[1].name())){var t=e.layers()[0].name(),r=/^__magic:(.*?)(?:,(.*))?$/.exec(t);if(r){if("artboard"===r[2]){var o=e.ancestors()[e.ancestors().length-1],a=MSArtboardGroup.alloc().init();a.frame().setX(e.frame().x()),a.frame().setY(e.frame().y()),a.frame().setWidth(e.frame().width()),a.frame().setHeight(e.frame().height()),o.removeLayer(e),o.addLayer(a),a.select_byExpandingSelection(!0,!1),e=a}var i=n(r,2);e.name=i[1]}}},renderFromSVG:function(e){var t=MSSVGImporter.new(),n=NSString.stringWithString(e).dataUsingEncoding(NSUTF8StringEncoding);return t.prepareToImportFromData(n),t.importAsLayer()},renderFromSketchJSON:function(e){try{var t=MSJSONDictionaryUnarchiver.unarchiveObjectFromDictionary_asVersion_corruptionDetected_error(e,"95",null,null);return t.class().mutableClass().alloc().initWithImmutableModelObject(t)}catch(e){this.logError("renderFromSketchJSON: ".concat(e))}return""}};e.exports=s}).call(this,n("./node_modules/@skpm/timers/timeout.js").setTimeout)},"./src/api/sketch-data.js":function(e,t,n){var r=n("./src/api/config.js").GradientTypes,o={rectToJSON:function(e){var t=e.rect,n=e.referenceRect;return n?{x:Math.round(10*(t.x()-n.x()))/10,y:Math.round(10*(t.y()-n.y()))/10,width:Math.round(10*t.width())/10,height:Math.round(10*t.height())/10}:{x:Math.round(10*t.x())/10,y:Math.round(10*t.y())/10,width:Math.round(10*t.width())/10,height:Math.round(10*t.height())/10}},pointToJSON:function(e){return{x:parseFloat(e.x),y:parseFloat(e.y)}},gradientToJSON:function(e){for(var t=[],n=e.stops().objectEnumerator(),o=n.nextObject();o;)t.push(this.colorStopToJSON(o)),o=n.nextObject();return{type:r[e.gradientType()],from:this.pointToJSON(e.from()),to:this.pointToJSON(e.to()),colorStops:t}},symbol2group_lt_53:function(e){var t=this;"MSSymbolInstance"==e.class()&&(e=e.detachByReplacingWithGroup()),"MSLayerGroup"==e.class()&&e.layers()&&e.layers().forEach(function(e){t.symbol2group_lt_53(e)})},symbol2group:function(e){var t=this;"MSSymbolInstance"==e.class()?e.detachStylesAndReplaceWithGroupRecursively(!0):"MSLayerGroup"==e.class()&&e.layers()&&e.layers().forEach(function(e){t.symbol2group(e)})},getLayerSketchJSON:function(e){var t=e.copy(),n=e.parentGroup();n.addLayer(t),+NSBundle.mainBundle().infoDictionary().CFBundleShortVersionString.UTF8String()>=53?"MSSymbolInstance"==t.class()?t=t.detachStylesAndReplaceWithGroupRecursively(!0):this.symbol2group(t):this.symbol2group_lt_53(t);var r=t.immutableModelObject(),o=MSJSONDataArchiver.archiveStringWithRootObject_error_(r,null);return n.removeLayer(t),o},getUploadDataForSelection:function(){var e=this,t=this.getSelected();if(!t)return 0;var n=[];return t.forEach(function(t){var r=t.frame(),o={name:e.nsstring2jsstring(t.name()),id:e.nsstring2jsstring(t.objectID()),width:Number("".concat(r.width())),base64Data:"".concat(e.getLayerImgData(t,"png",e.getDocument())),JSONData:"".concat(e.getLayerSketchJSON(t))};n.push(o)}),n}};e.exports=o},"./src/api/sketch-measure.js":function(e,t,n){function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){o(e,t,n[t])})}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s,c,l,u,p,d=n("./src/template/index.html.js").TEMPLATE,h=n("./src/api/lib/timeout.js").setTimeout,f=[],g={calculateProgress:function(e,t,n){if(n&&n.getMessageHandler&&e&&t&&t>=e){var r=parseInt(e/t*100,10);r=Math.min(r,99),this.broadcastMessage({context:n,type:"ics-parse-process",messageParams:{progress:r,processText:"Sketch Layer Analysis"}})}},broadcastMessage:function(e){var t=e.context,n=e.type,r=e.messageParams,o=t.getMessageHandler();if(o&&o.$emit){var a;switch(n){case"ics-upload-finish":a=o.messageTypes.MSG_EXPORT_ICS_FINISH;break;case"ics-parse-process":a=o.messageTypes.MSG_EXPORT_ICS_PROGRESS;break;case"export-local-finish":a=o.messageTypes.MSG_EXPORT_LOCAL_FINISH;break;case"export-demoplus-finish":a=o.messageTypes.MSG_EXPORT_DEMOPLUS_FINISH}a&&(o.$emit(a,r),r=null)}}},m={parseLayer:function(e,t){if(!this.parseFilter(e))return{};var n=t.absoluteRect(),r="".concat(e.objectID()),o="".concat(e.name()),a="".concat(e.class()),i={objectID:r,name:o,type:a,rect:this.rectToJSON({rect:e.absoluteRect(),referenceRect:n})},s=null;switch(a){case"MSTextLayer":i=this.parseText({layer:e,artboard:t,baseData:i}).layerData;break;case"MSBitmapLayer":case"MSArtboardGroup":break;default:i=this.parseShape({layer:e,baseData:i}).layerData}if(this.hasExportOptions(e)||"MSSliceLayer"===a){var c=this.parseSlice({layer:e,artboard:t,baseData:i});i=c.layerData,s=c.sliceData}return{layerData:i,sliceData:s}},parseImage:function(){return null},parseSlice:function(e){var t=e.layer,n=e.artboard,r=e.baseData,o=Object.assign({},r),a=n.objectID(),i=t.objectID();o.type="slice";var c=t.exportOptions().exportFormats(),l=c&&c.length?"".concat(c[0].fileFormat()):"png",d=o.name,h="assets/".concat(a,"/").concat(i,".").concat(l),g={name:d,format:l,path:"".concat(u,"/").concat(h)},m=Object.assign({},o);m.exportable=[g];var S=this.exportSketchToFile({layer:t,path:"".concat(s,"/"),subPath:"assets/".concat(a,"/"),scale:2,name:i,format:l});return this.icsUploadFile&&p&&f.push({filepath:S,ossPath:g.path}),{sliceData:m,layerData:o}},parseShape:function(e){var t=e.layer,n=e.baseData,r=t.style();return{layerData:Object.assign({},n,{css:this.nsarray2jsarray(t.CSSAttributes()),rotation:t.rotation(),radius:this.getRadius(t),borders:this.getBorders(r),shadows:this.getShadows(r),fills:this.getFills(r)})}},parseText:function(e){var t=e.layer,n=e.baseData,r=e.artboard,o=Object.assign({},n,{content:"".concat(t.stringValue()),color:this.colorToJSON(t.textColor()),fontSize:t.fontSize(),fontFace:"".concat(t.fontPostscriptName()),textAlign:t.textAlignment(),letterSpacing:t.characterSpacing()||0,lineHeight:t.lineHeight()||t.font().defaultLineHeightForFont(),css:this.nsarray2jsarray(t.CSSAttributes())});return{layerData:this.parseSvgText({baseData:o,layer:t,artboard:r})}},parseSvgText:function(e){var t=this,n=e.layer,r=e.baseData,o=e.artboard;if(!this.isClass(n,MSTextLayer))return r;if(n.disableCheckSvgText)return r;if(!this.isSvgText(n))return r;var a,s,c=Object.assign({},r),l=SketchSVGExporter.new().exportLayers([n.immutableModelObject()]),u="".concat(NSString.alloc().initWithData_encoding(l,4)),p=new RegExp("<tspan([^>]+)>([^<]*)</tspan>","g"),d=new RegExp(">([^<]*)<"),h=[],f=this.getRect(n);u.match(p).forEach(function(e){var n=t.getTextAttrs(e),r=e.match(d);if(r&&r.length>1){var o=i(r,2)[1];n.content=o}a=!a||a&&a>t.nsstring2jsnumber(n.x)?t.nsstring2jsnumber(n.x):a,s=!s||s&&s>t.nsstring2jsnumber(n.y)?t.nsstring2jsnumber(n.y):s,h.push(n)});var g=n.parentGroup(),m=c.lineHeight,S=c.letterSpacing,b=c.textAlign,y=c.fontFace,v=[];return h.forEach(function(e){if(e.content.trim()&&e.fill){var n=t.addText(),r=t.hexToRgb(e.fill);if(r&&Object.prototype.hasOwnProperty.call(r,"r")){var i=MSColor.colorWithRed_green_blue_alpha(r.r/255,r.g/255,r.b/255,e["fill-opacity"]||1);n.setName(e.content),n.setStringValue(e.content),n.setTextColor(i),n.setFontSize(e["font-size"]||c.fontSize),n.setLineHeight(m),n.setCharacterSpacing(t.nsstring2jsnumber(e["letter-spacing"])||S),n.setTextAlignment(b),e["font-family"]?n.setFontPostscriptName(e["font-family"].split(",")[0]):n.setFontPostscriptName(y),g.addLayers([n]);var l=t.getRect(n);l.setX(f.x+(t.nsstring2jsnumber(e.x)-a)),l.setY(f.y+(t.nsstring2jsnumber(e.y)-s)),n.disableCheckSvgText=!0;var u=t.parseLayer(n,o);c=u.layerData,v.push(c),t.removeLayer(n)}}}),v},isSvgText:function(e){var t=0;if(!this.isClass(e,MSTextLayer))return!1;try{t=e.attributedString().treeAsDictionary().value.attributes.length}catch(e){this.logError("isSvgText: layer.attributedString().treeAsDictionary().value.attributes.length")}return t>1},parseFilter:function(e){return!!e&&(!this.isClass(e,MSSymbolInstance)&&(!!e.isVisible()&&(!this.isParentsHidden(e)&&((!e.booleanOperation||1!==e.booleanOperation())&&(!e.hasClippingMask()&&(!this.isParentGroupWithFill(e)&&!(this.isClass(e,MSTextLayer)&&e.isEmpty&&e.isEmpty())))))))},isParentGroupWithFill:function(e){if(e.parentGroup){var t=e.parentGroup();if(!t||!t.class||t.class()!==MSShapeGroup)return!1;var n=this.getFills(t.style()),r=!1;return n&&n.length&&n.forEach(function(e){r||"color"===e.fillType&&(r=!0)}),r}return!1},isParentsHidden:function(e){for(var t=e,n=!1;!n&&t&&t.parentGroup;)t&&t.isVisible&&t.isVisible()?t=t.parentGroup():n=!0;return n}},S={getDefaultExportTempPath:function(){return"".concat(NSHomeDirectory(),"/.FuisonCoolExport")},chooseLocalPathByUser:function(){var e=this.getDocument().displayName().stringByDeletingPathExtension(),t=NSSavePanel.savePanel();return t.setCanCreateDirectories(!0),t.setNameFieldStringValue(e),t.runModal()==NSOKButton?"".concat(t.URL().path()):""},getMetaJSON:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"./",t={artboards:{},documentID:"".concat(this.getDocument().documentData().objectID())},n=null;c&&c.constructor===Array&&c.length&&(n=c);var r=0,o=[];return this.getPages().forEach(function(a){"Symbols"!==a.name()&&"组件"!==a.name()&&a.artboards().forEach(function(a){if(a.class()===MSArtboardGroup){var i="".concat(a.objectID());n&&-1===n.indexOf(i)||(o.push(a),r+=a.children().count(),t.artboards[i]={imagePath:"".concat(e,"/preview/").concat(i,".png"),artboardName:"".concat(a.name()),dataPath:"".concat(e,"/data/").concat(i,".json"),objectID:i})}})}),{meta:t,artboards:o,layersCount:r}},dumplicateAllSymbols:function(e,t){var n=this,r=[],o=[],a=0;e.slice().forEach(function(e){e.children().forEach(function(e){e.class()===MSSymbolInstance&&o.push(e)})});var i=o.length;g.broadcastMessage({context:this,type:"ics-parse-process",messageParams:{processText:"Symbol Transforming..."}});!function e(){if(a>=i||0===i)t&&t(r);else{var s=n.symbolTransformToGroup(o[a]);s&&r.push(s),a+=1,h(e,0)}}()},symbolTransformToGroup:function(e){var t,n=e.duplicate();return n.detachStylesAndReplaceWithGroupRecursively?t=n.detachStylesAndReplaceWithGroupRecursively(!0):n.detachByReplacingWithGroup&&(t=n.detachByReplacingWithGroup()),t&&t.resizeToFitChildrenWithOption&&t.resizeToFitChildrenWithOption(0),t},clearTempSymbolGroups:function(e){var t=this,n=e.groups,r=e.nextTick;g.broadcastMessage({context:this,type:"ics-parse-process",messageParams:{processText:"Symbol Temp Group Cleaning..."}});!function e(){if(0===n.length)r&&r();else{var o=n.shift();t.removeLayer(o),h(e,0)}}()},parseStart:function(e){var t,n,r,o,i,s=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},p=e.slice(),d=p.length,f=0,m=0,S=0;try{!function e(){if(0===f&&(t=p[m],n="".concat(t.objectID()),r=t.children(),o=r.count(),i={layers:{},slices:{},objectID:n,name:"".concat(t.name())}),f>=o)return m+=1,f=0,s.logSuccess("Artboart Progress: ".concat(m," / ").concat(d)),c({artboardJson:i,artboard:t}),void(m>=d?(u(),f=null,m=null,t=null,n=null,r=null,o=null,i=null,p=null,d=null):h(function(){e()},0));var b=r[f];f+=1,S+=1,g.calculateProgress(S,l,s);try{var y=s.parseLayer(b,t),v=y.sliceData,w=y.layerData;v&&(i.slices[b.objectID()]=v),w&&("object"===a(w)&&w.constructor===Array?w.forEach(function(e){i.layers[e.objectID]=e}):i.layers[b.objectID()]=w)}catch(e){s.logError("parseLayer: ".concat(JSON.stringify(e)))}h(function(){e()},0)}()}catch(e){this.logError("layersParseFactorial: ".concat(JSON.stringify(e))),this.logError("errorInfo: ".concat(JSON.stringify({artboardsID:"".concat(n),artboartName:"".concat(t.name()),layerIndex:"".concat(f),layerName:"".concat(r[f].name()),layerID:"".concat(r[f].objectID())})))}}},b={exportToLocal:function(e){var t=this,n=Object.assign({},e||{});s=this.chooseLocalPathByUser(),this.logInfo("exportToLocal:sketchExportSavePath:".concat(s)),c=n.selectedArtboardAndPage?n.selectedArtboardAndPage:[];var r=this.getMetaJSON(),o=r.artboards,a=r.layersCount;u="./",l=a;try{this.logInfo("exportToLocal:dumplicateAllSymbols:start"),this.dumplicateAllSymbols(o,function(e){t.logSuccess("exportToLocal:dumplicateAllSymbols:done"),t.parseLocalStart({artboards:o,tempGroups:e,_sketchExportSavePath:s})})}catch(e){this.logError("dumplicateAllSymbols: ".concat(JSON.stringify(e)))}},parseLocalStart:function(e){var t=this,n=e.artboards,r=e._sketchExportSavePath,o=e.tempGroups;this.logInfo("parseLocalStart:start");var a={artboards:[]};this.parseStart(n,function(e){var n=e.artboard,o=e.artboardJson;t.logSuccess("exportToLocal:onArtboardParseFinish");var i=Object.assign({},o),s="".concat(n.objectID()),c=n.frame().size();i.width=parseInt("".concat(c.width),10),i.height=parseInt("".concat(c.height),10),i.imagePath="./preview/".concat(s,".png"),i.thumbnail="./thumbnail/".concat(s,".png"),a.artboards.push(i),t.exportSketchToFile({path:"".concat(r,"/"),layer:n,scale:2,name:s,subPath:"preview/"}),t.exportSketchToFile({path:"".concat(r,"/"),layer:n,scale:.3,name:s,subPath:"thumbnail/"})},function(){t.logSuccess("exportToLocal:onAllArtboardsParseFinish"),t.clearTempSymbolGroups({groups:o}),t.writeFile({text:"window.__JSONDATA__=".concat(JSON.stringify(a)),filepath:"".concat(r,"/data/jsondata.js")}),t.writeFile({text:d,filepath:"".concat(r,"/index.html")}),g.broadcastMessage({context:t,type:"export-local-finish",messageParams:r}),c=null,s=null,l=null,a=null})}},y={exportToIcs:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t);this.logInfo("STEP-3:解析开始");var o=n.ossConfig;if(!o)return this.logError("exportToIcs: no oss config"),!1;c=n.selectedArtboardAndPage?n.selectedArtboardAndPage:[],n.sketchExportUploadOssPath=o.uploadPath.replace(/\/$/,"");var a=n.filename||this.getFileName();s=this.getDefaultExportTempPath(),this.deleteFolder(s),s="".concat(s,"/").concat(a),this.logInfo("exportToIcs: ".concat(s));var i=this.getMetaJSON(n.sketchExportUploadOssPath),d=i.artboards,h=i.meta;this.logInfo("STEP-3:获取MetaJSON"),this.writeFile({text:JSON.stringify(h),filepath:"".concat(s,"/meta.json")});var f={AccessKeyId:o.accessKeyId,AccessKeySecret:o.accessKeySecret,SecurityToken:o.stsToken,bucketName:o.bucket};f.sketchExportUploadOssPath=n.sketchExportUploadOssPath,u=n.sketchExportUploadOssPath;var g={objectKey:p="".concat(f.sketchExportUploadOssPath,"/meta.json"),filepath:"".concat(s,"/meta.json")};return this.logInfo("STEP-3:上传MetaJSON"),this.icsUploadFile(r({},f,g))?(this.logSuccess("STEP-3:上传MetaJSON：success"),this.logInfo("STEP-3:分离Symbol"),this.dumplicateAllSymbols(d,function(t){e.logSuccess("STEP-3:分离Symbol:Success");var r=e.getMetaJSON(n.sketchExportUploadOssPath).layersCount;l=r,e.parseIcsStart({artboards:d,config:f,tempGroups:t,_sketchExportSavePath:s})}),!0):(this.logError("STEP-3:上传MetaJSON：fail"),!1)},icsUploadFile:function(e){var t={objectKey:e.objectKey,filepath:e.filepath,ossConfig:{AccessKeyId:e.AccessKeyId,AccessKeySecret:e.AccessKeySecret,SecurityToken:e.SecurityToken,bucketName:e.bucketName}};return this.uploadFileToOss(t)},parseIcsStart:function(e){var t=this,n=e.artboards,r=e._sketchExportSavePath,o=e.config,a=e.tempGroups;this.logInfo("STEP-4:解析Layer");var i=Object.assign({},o);this.parseStart(n,function(e){var n=e.artboard,o=e.artboardJson;t.logSuccess("STEP-4:一个artboartd解析完成");var a=Object.assign({},o),s="".concat(n.objectID()),c=n.frame().size();a.width=parseInt("".concat(c.width),10),a.height=parseInt("".concat(c.height),10),a.imagePath="./preview/".concat(s,".png");var l=t.exportSketchToFile({path:"".concat(r,"/"),layer:n,scale:2,name:s,subPath:"preview/"});i.objectKey="".concat(i.sketchExportUploadOssPath,"/preview/").concat(s,".png"),i.filepath=l,t.icsUploadFile(i)?t.logSuccess("STEP-4:上传画板图片成功"):t.logError("STEP-4:上传画板图片失败"),t.writeFile({text:JSON.stringify(a),filepath:"".concat(r,"/data/").concat(s,".json")}),i.objectKey="".concat(i.sketchExportUploadOssPath,"/data/").concat(s,".json"),i.filepath="".concat(r,"/data/").concat(s,".json"),t.icsUploadFile(i)?t.logSuccess("STEP-4:上传画板JSON成功"):t.logError("STEP-4:上传画板JSON失败")},function(){t.logSuccess("STEP-4:所有画板导出成功"),t.clearTempSymbolGroups({groups:a,nextTick:function(){t.logSuccess("STEP-4:清除Symbol缓存成功"),g.broadcastMessage({context:t,type:"ics-parse-process",messageParams:{processText:"Sketch Slice Uploading..."}}),t.logInfo("STEP-4:上传切片图片"),function e(n){if(0===f.length&&n)return t.logSuccess("uploadSlices:done"),void n();var r=f.shift();r.ossPath&&r.filepath&&(i.objectKey=r.ossPath,i.filepath=r.filepath,t.icsUploadFile(i)?t.logSuccess("isSliceUploadSuccess:true:".concat(i.objectKey)):t.logError("isSliceUploadSuccess:false:".concat(JSON.stringify(i)))),e(n)}(function(){t.logSuccess("STEP-4:上传切片图片成功"),g.broadcastMessage({context:t,type:"ics-upload-finish",messageParams:{metaPath:p,filepath:r}}),t.logInfo("STEP-4:通知业务层解析成功: ".concat(JSON.stringify({metaPath:p}))),t.deleteFolder(r),p=null,u=null,s=null})}})})}},v={exportToDemoPlus:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t||{}),r=n.filename||this.getFileName();s=this.getDefaultExportTempPath(),this.deleteFolder(s),s="".concat(s,"/").concat(r),this.logInfo("exportToDemoPlus:sketchExportSavePath:".concat(s)),n.selectedArtboardAndPage&&(c=n.selectedArtboardAndPage);var o=this.getMetaJSON(),a=o.artboards,i=o.layersCount;u="./",l=i;try{this.logInfo("exportToDemoPlus:dumplicateAllSymbols:start"),this.dumplicateAllSymbols(a,function(t){e.logSuccess("exportToDemoPlus:dumplicateAllSymbols:done"),e.parseDemoPlusStart({artboards:a,tempGroups:t,_sketchExportSavePath:s,filename:r})})}catch(e){this.logError("dumplicateAllSymbols: ".concat(JSON.stringify(e)))}},parseDemoPlusStart:function(e){var t=this,n=e.artboards,r=e.tempGroups,o=e._sketchExportSavePath,a=e.filename;this.logInfo("parseDemoPlusStart:start");var i={artboards:[]};this.parseStart(n,function(e){var n=e.artboard,r=e.artboardJson;t.logSuccess("exportToDemoPlus:onArtboardParseFinish");var a=Object.assign({},r),s="".concat(n.objectID()),c=n.frame().size();a.width=parseInt("".concat(c.width),10),a.height=parseInt("".concat(c.height),10),a.imagePath="./preview/".concat(s,".png"),a.thumbnail="./thumbnail/".concat(s,".png"),i.artboards.push(a),t.exportSketchToFile({path:"".concat(o,"/"),layer:n,scale:2,name:s,subPath:"preview/"}),t.exportSketchToFile({path:"".concat(o,"/"),layer:n,scale:.3,name:s,subPath:"thumbnail/"})},function(){t.logSuccess("exportToDemoPlus:onAllArtboardsParseFinish"),t.clearTempSymbolGroups({groups:r}),t.writeFile({text:"window.__JSONDATA__=".concat(JSON.stringify(i)),filepath:"".concat(o,"/data/jsondata.js")}),t.writeFile({text:d,filepath:"".concat(o,"/index.html")});var e=o.split("/");e.pop(),e=e.join("/");var n="".concat(e,"/").concat(a,".zip");if(!t.zipFolder({from:o,to:n}))return t.logError("压缩文件失败!"),t.logError(n),void t.logError(o);g.broadcastMessage({context:t,type:"export-demoplus-finish",messageParams:{zipFilePath:n,sketchFilePath:t.getSketchFileURL()}}),c=null,s=null,l=null,i=null})}};e.exports=r({},m,S,b,y,v)},"./src/api/util.js":function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("./package.json"),a={isClass:function(e,t){return e.class&&e.class()===t},getResourcePath:function(){for(var e="".concat(coscript.env().scriptURL.path()),t=NSString.alloc().initWithString(e);"sketchplugin"!=="".concat(t.lastPathComponent().pathExtension());)t=t.stringByDeletingLastPathComponent();return"".concat(t,"/Contents/Resources")},getSketchVersion:function(){var e=NSBundle.mainBundle().infoDictionary().CFBundleShortVersionString;return"".concat(e)},getPluginVersion:function(){return o.version},checkSketchPluginUpdate:function(){NSApp.delegate().checkForAndDownloadPluginUpdates()},getScreenInfo:function(){return{width:Number("".concat(NSScreen.mainScreen().frame().size.width)),height:Number("".concat(NSScreen.mainScreen().frame().size.height))}},appearance:function(){switch("".concat(NSAppearance.currentAppearance().name())){case"NSAppearanceNameAqua":case"NSAppearanceNameVibrantLight":case"NSAppearanceNameAccessibilityHighContrastAqua":case"NSAppearanceNameAccessibilityHighContrastVibrantLight":return"light";case"NSAppearanceNameDarkAqua":case"NSAppearanceNameVibrantDark":case"NSAppearanceNameAccessibilityHighContrastDarkAqua":case"NSAppearanceNameAccessibilityHighContrastVibrantDark":return"dark";default:return"unknown"}},version2number:function(e){var t=0;return e.split(".").forEach(function(e,n){t+=Number(e)*Math.pow(1e3,3-n)}),t},versionCompare:function(e){var t=e.version1,n=e.version2,r=this.version2number(t),o=this.version2number(n);return r>o?1:r===o?0:-1}};a.jsonExtend=function e(t){var n=t.from,o=t.to;return"object"!==r(n)?n:(n.constructor===Object?Object.keys(n).forEach(function(t){var a=n[t];"object"!==r(a)?o[t]=a:o[t]=e({from:a,to:o[t]||{}})}):n.constructor===Array&&("object"!==r(o)||o.constructor!==Array?o=n:n.forEach(function(e){o.push(e)})),o)},e.exports=a},"./src/config.js":function(e,t,n){"use strict";n.r(t);var r={};r.JSBRIDGE_NAME="FusionCoolMessageCenter",r.internal_prod_mainURL="https://fusion.alibaba-inc.com".concat("/plugin/cool"),r.internal_pre_mainURL="https://pre-fusion.alibaba-inc.com".concat("/plugin/cool"),r.external_prod_mainURL="https://fusion.design".concat("/plugin/cool"),r.external_pre_mainURL="https:///pre-www.fusion.design".concat("/plugin/cool"),t.default=r},"./src/index.js":function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"onSelectionChangedFinish",function(){return o}),n.d(t,"onCloseDocument",function(){return a}),n.d(t,"onExportSketch",function(){return i}),n.d(t,"onShutdown",function(){return c}),n.d(t,"onStartup",function(){return l}),n.d(t,"onOpenDocument",function(){return u}),n.d(t,"onDebug",function(){return p});var r=n("./src/wkwebview/index.js");function o(e){var t=NSThread.mainThread().threadDictionary()[e.actionContext.document];t&&t.onSelectionChanged&&t.onSelectionChanged()}function a(){}function i(){var e=NSThread.mainThread().threadDictionary()[context.document];e&&e.openExportDialog&&e.openExportDialog()}function s(t){if(t){var n=NSThread.mainThread().threadDictionary();n[t]||e(function(){var e=Object(r.default)().new().init2(t);n[t]=e,e.autorelease()},0)}}function c(){var t=NSThread.mainThread().threadDictionary(),n=NSDocumentController.sharedDocumentController().documents();if(n&&n.count()){var r=n.slice(0);!function n(){if(r.length){var o=r.pop(),a=t[o];if(a)try{a.closeFusionCool&&a.closeFusionCool(),t[o].release(),t[o]=nil}catch(e){}e(n)}}()}}function l(){var e=NSDocumentController.sharedDocumentController().documents();e&&e.count()&&e.forEach(function(e){s(e)})}function u(e){s(e.actionContext.document)}function p(e){NSThread.mainThread().threadDictionary()[e.document]?c():l()}}.call(this,n("./node_modules/@skpm/timers/timeout.js").setTimeout)},"./src/template/index.html.js":function(e,t){e.exports={TEMPLATE:'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<meta http-equiv="X-UA-Compatible" content="ie=edge">\n<title>FusionCool标注</title>\n</head>\n<body>\n\n<style>\n#app{position: absolute;top:0;left:0;width: 100%;height:100%;}\n</style>\n<div id="app"></div>\n<script src="./data/jsondata.js" type="text/javascript"><\/script>\n<script src="https://g.alicdn.com/fusion-platform/sketch-markup/style.js" type="text/javascript"><\/script>\n<script src="https://g.alicdn.com/fusion-platform/sketch-markup/app.js" type="text/javascript"><\/script>\n</body>\n</html>'}},"./src/uiwebview/login.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/cocoascript-class/lib/index.js"),o=n.n(r),a=n("./src/uiwebview/wrap.js"),i={className:"FCLoginDialog",superclass:WebView,init:function(){this.drawsBackground=!1,this.shouldCloseWithWindow=!0,this.setFrameLoadDelegate(this)},init2:function(e){this._nspanel=e},"webView:didCreateJavaScriptContext:forFrame:":function(e){try{e.windowScriptObject().setValue_forKey(Object(a.default)({testKey:"fusioncool-test",loginSuccess:function(){e._nspanel.loginSuccess()},stop:function(){e._nspanel.stop()}}),"FCLogin")}catch(e){log(e)}}},s={className:"FCLoginWindow",superclass:NSWindow,init2:function(e){return this.standardWindowButton(NSWindowMiniaturizeButton).setHidden(!0),this.standardWindowButton(NSWindowZoomButton).setHidden(!0),this.setDelegate(this),this.viewInit(e),this},setSuperView:function(e){this.superView=e},callSuperView:function(e){if(this.superView){var t=NSString.stringWithFormat("%@","try {\n      ".concat(e,"\n    } catch (err) { console.error(err);}"));this.superView.evaluateJavaScript_completionHandler(t,nil)}},viewInit:function(e){var t=o()(i).new();t.init2(this);var n=this.contentView();t.setAutoresizingMask(NSViewWidthSizable+NSViewHeightSizable),t.setFrame(n.bounds()),n.addSubview(t),t.setMainFrameURL(e),this.view=t},stopBlocking:function(){NSApplication.sharedApplication().stopModal()},loginSuccess:function(){this.callSuperView("window.FusionCool.getLoginStatusAndThemes()"),this.stop()},stop:function(){this.view&&this.view.close&&this.view.close(),this.stopBlocking(),this.close()},"windowWillClose:":function(){this.stopBlocking()}};t.default=function(){return o()(s)}},"./src/uiwebview/wrap.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/cocoascript-class/lib/index.js"),o=n.n(r);function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=Array.prototype.slice;function s(e){var t=e;return e.isKindOfClass(NSString.class())?t="".concat(e):e.isKindOfClass(NSNumber.class())?t=e+0:e.isKindOfClass(NSDictionary.class())?(t={},Object.keys(e).forEach(function(n){t[n]=s(e[n])})):e.isKindOfClass(NSArray.class())&&(t=[],e.forEach(function(e){t.push(s(e))})),t}function c(e){if("WebScriptObject"==e.class()){var t=e.JSValue();return t.hasProperty("call")?function(){e.callWebScriptMethod_withArguments("call",[null].concat(i.call(arguments)).map(u))}:t.isArray()?s(t.toArray()):s(t.toDictionary())}return s(e)}var l=o()({className:"FCWrapper","invokeDefaultMethodWithArguments:":function(e){var t,n=this.core;if("function"==typeof n){var r=i.call(e).map(c);t=n.apply(void 0,a(r))}return u(t)},"invokeUndefinedMethodFromWebScript:withArguments:":function(e,t){var n,r=this.core;return(e+="")in r&&"_"!==e[0]&&(t=i.call(t).map(c),"function"==typeof r[e]?n=r[e].apply(r,a(t)):t[0]?r[e]=t[0]:n=r[e]),u(n)}});function u(e){switch(Object.prototype.toString.call(e)){case"[object String]":return NSString.stringWithString(e);case"[object Object]":case"[object Function]":var t=l.new();return t.core=e,t;case"[object Null]":case"[object Undefined]":return null;case"[object Array]":return NSArray.arrayWithArray(e.map(u));default:return e}}t.default=u},"./src/wkwebview/dialog.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/cocoascript-class/lib/index.js"),o=n.n(r),a=n("./src/wkwebview/webview.js"),i=n("./src/wkwebview/messageCenter.js");function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c={superclass:NSWindow,api:nil,init2:function(e,t){return this.standardWindowButton(NSWindowMiniaturizeButton).setHidden(!0),this.standardWindowButton(NSWindowZoomButton).setHidden(!0),this.setDelegate(this),this.api=t,this.viewInit(e,this.api),this},viewInit:function(e,t){var n=Object(a.default)(t,!0),r=this.contentView();n.setAutoresizingMask(NSViewWidthSizable+NSViewHeightSizable),n.setFrame(r.bounds()),r.addSubview(n);var o=NSURLRequest.requestWithURL(NSURL.URLWithString(e));n.loadRequest(o),this.view=n},stopBlocking:function(){NSApplication.sharedApplication().stopModal()},stop:function(){this.view.stopLoading(),this.stopBlocking(),this.close()},"windowWillClose:":function(){log("dialog closed"),this.stopBlocking(),this.removeDialogEvents&&this.removeDialogEvents()}};t.default=function(){return o()(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){s(e,t,n[t])})}return e}({},c,i.default))}},"./src/wkwebview/index.js":function(e,t,n){"use strict";n.r(t),function(e){var r=n("sketch"),o=n.n(r),a=n("./node_modules/cocoascript-class/lib/index.js"),i=n.n(a),s=n("./src/wkwebview/webview.js"),c=n("./src/config.js"),l=n("./src/api/index.js"),u=n.n(l),p=n("./src/wkwebview/dialog.js"),d=n("./src/wkwebview/message.js"),h=n.n(d),f=n("./src/wkwebview/messageCenter.js"),g=n("./src/uiwebview/login.js");function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}u.a.setMessageHandler(h.a);var S={sharedDialog:nil,document:nil,fiber:nil,api:nil,view:nil,settings:c.default,editor:nil,init2:function(e){var t=this;this.fiber=o.a.Async.createFiber(),this.document=e;var n={dialog:function(e){var n=e.url,r=e.options;t.dialog({url:n,options:r})},showLogin:function(e){var n=e.url,r=e.options;t.showLogin({url:n,options:r})},openEditor:function(e){var n=e.url;t.openEditor({url:n})},closeDialog:this.closeDialog,closeEditor:this.closeEditor,stopBlocking:this.stopBlocking,callMainFrameWindowFunction:function(e){var n=e.script;t.callMainFrameWindowFunction({script:n,view:t.view})},notifyEditor:function(e){if(t.editor){var n="window.onSketchEventTrigger(".concat(JSON.stringify(e),")");t.editor.callMainFrameWindowFunction({script:n})}},switchTab:this.switchTab};return this.api=Object.assign({},u.a,n),this.view=Object(s.default)(this.api),this.inject(),this.loadPageURL(),this.systemNotificationCenter(),this.addExportEventListener&&this.addExportEventListener(),this},loadPageURL:function(){var e;e=u.a.isAlibabaNet()?this.settings.internal_prod_mainURL:this.settings.external_prod_mainURL,u.a.logInfo("loadPageURL:".concat(e));var t=NSURLRequest.requestWithURL(NSURL.URLWithString(e));this.view.loadRequest(t)},openEditor:function(e){var t=e.url,n=NSWindowStyleMaskTitled+NSWindowStyleMaskClosable+NSWindowStyleMaskResizable,r=this.document.documentWindow().frame(),o=Object(p.default)().alloc().initWithContentRect_styleMask_backing_defer(NSMakeRect(r.size.width-240-240+r.origin.x,r.origin.y,240,r.size.height-98),n,NSBackingStoreBuffered,!0);return this.editor=o,o.init2(t,this.api),this.document.documentWindow().addChildWindow_ordered(o,NSWindowAbove),o.autorelease(),1},closeEditor:function(){return this.editor&&this.editor.stop&&(this.editor.stop(),this.editor=nil),1},dialog:function(e){var t=e.url,n=e.options,r={width:n.width||400,height:n.height||300,resizable:n.resizable||!1},o=NSWindowStyleMaskTitled+NSWindowStyleMaskClosable;r.resizable&&(o=NSWindowStyleMaskResizable+o);var a=Object(p.default)().alloc().initWithContentRect_styleMask_backing_defer(NSMakeRect(0,0,r.width,r.height),o,NSBackingStoreBuffered,!0);return this.sharedDialog=a,a.init2(t,this.api),NSApplication.sharedApplication().runModalForWindow(a),a.autorelease(),1},showLogin:function(e){var t=e.url,n=e.options,r={width:n.width||100,height:n.height||600,resizable:n.resizable||!1},o=NSWindowStyleMaskTitled+NSWindowStyleMaskClosable;r.resizable&&(o=NSWindowStyleMaskResizable+o);var a=Object(g.default)().alloc().initWithContentRect_styleMask_backing_defer(NSMakeRect(0,0,r.width,r.height),o,NSBackingStoreBuffered,!0);return a.init2(t),a.setSuperView(this.view),NSApplication.sharedApplication().runModalForWindow(a),a.autorelease(),1},closeDialog:function(){return this.sharedDialog&&this.sharedDialog.stop&&(this.sharedDialog.stop(),this.sharedDialog=nil),1},stopBlocking:function(){return this.sharedDialog&&this.sharedDialog.stopBlocking&&this.sharedDialog.stopBlocking(),1},systemNotificationCenter:function(){NSDistributedNotificationCenter.defaultCenter().addObserver_selector_name_object(this,NSStringFromSelector("onAppearanceChanged"),NSString.stringWithString("AppleInterfaceThemeChangedNotification"),nil)},onAppearanceChanged:function(){var t=this;e(function(){var e={type:"onAppearanceChanged",data:{theme:t.api.appearance()}};if(t.nativeView&&t.nativeView.color&&"MSInspectorBackgroundView"==t.nativeView.class()&&t.stackView&&t.stackView.setBackgroundColor){var n=t.nativeView.color();t.stackView.setBackgroundColor(n)}var r="window.onSketchEventTrigger(".concat(JSON.stringify(e),")");t.callMainFrameWindowFunction({script:r})},1e3)},inject:function(){for(var e,t,n=this.document.documentWindow().contentView().subviews().objectAtIndex(0),r=n.subviews().count()-1;r>0&&(e=n.subviews().objectAtIndex(r),r+=1,"NSStackView"!=(t=e.subviews().objectAtIndex(0)).class()););this.stackView=t,t.spacing=8,t.alignment=NSLayoutAttributeCenterX;var o=t.subviews()[1],a=o.frame().size.width;if(this.nativeView=o,"MSInspectorBackgroundView"==o.class())t.setWantsLayer(!0),t.setBackgroundColor(o.color());else{var i=NSColor.colorWithDeviceRed_green_blue_alpha(236/255,236/255,236/255,1);this.view.setBackgroundColor(i)}t.removeView(o);var s=NSTabView.new();s.tabViewType=NSNoTabsNoBorder;var c=NSTabViewItem.new(),l=NSBundle.mainBundle().infoDictionary().CFBundleShortVersionString.UTF8String();if(l&&+l<52){var p=NSStackView.new();p.insertView_atIndex_inGravity(o,0,NSStackViewGravityTop),c.view=p}else c.view=o;var d=NSTabViewItem.new();d.view=this.view,s.addTabViewItem(c),s.addTabViewItem(d),s.widthAnchor().constraintEqualToConstant(a).active=!0,this.tabView=s,t.insertView_atIndex_inGravity(s,1,NSStackViewGravityTop);var h=NSSegmentedControl.new();h.segmentStyle=NSSegmentStyleRounded,h.segmentCount=2;var f=NSImage.new().initWithContentsOfFile("".concat(u.a.getResourcePath(),"/sketch.png")),g=NSImage.new().initWithContentsOfFile("".concat(u.a.getResourcePath(),"/fusion.png"));f.template=!0,g.template=!0,h.setImage_forSegment(f,0),h.setImage_forSegment(g,1),h.setImageScaling_forSegment(NSImageScaleProportionallyDown,0),h.setImageScaling_forSegment(NSImageScaleProportionallyDown,1),h.setWidth_forSegment(28,0),h.setWidth_forSegment(28,1),h.heightAnchor().constraintEqualToConstant(24).setActive(1),h.setSelected_forSegment(!0,0),h.setTarget(this),h.subviews()[0].setToolTip("Sketch"),h.subviews()[1].setToolTip("FusionCool"),h.setAction(NSStringFromSelector("onSegmentTabChange")),t.insertView_atIndex_inGravity(h,1,NSStackViewGravityTop),this.segc=h},onSegmentTabChange:function(e){var t=e.selectedSegment();this.tabView.selectTabViewItemAtIndex(t)},switchTab:function(e){this.tabView.selectTabViewItemAtIndex(e),this.segc.setSelected_forSegment(!0,e)},onSelectionChanged:function(){u.a.handlerSvgMagicRules&&u.a.handlerSvgMagicRules(),u.a.renderConfirm&&u.a.renderConfirm();var e=[];u.a.getLayer()&&(e=u.a.getSketchSelections());var t={type:"onSelectionChange",data:e},n="window.onSketchEventTrigger(".concat(JSON.stringify(t),")");this.callMainFrameWindowFunction({script:n})},closeFusionCool:function(){var e=this.stackView,t=this.nativeView,n=this.view;if(t&&n)if(e&&e.subviews&&3===e.subviews().count()){var r=e.subviews(),o=r[0],a=r[1],i=r[2],s=o.frame().size,c=a.frame().size,l=e.frame().size,u=l.height-s.height,p=l.height-s.height-c.height;e.spacing=0,o.removeFromSuperview(),a.removeFromSuperview(),i.removeFromSuperview(),n.stopLoading(),n.configuration().userContentController().removeAllUserScripts(),n.release(),this.view=null,o.widthAnchor().constraintEqualToConstant(l.width).setActive(1),o.heightAnchor().constraintEqualToConstant(s.height).setActive(1),t.widthAnchor().constraintEqualToConstant(l.width).setActive(1),t.heightAnchor().constraintEqualToConstant(u).setActive(1),e.addArrangedSubview(o),e.addArrangedSubview(t),t.heightAnchor().constraintEqualToConstant(u-p).setActive(1),NSDistributedNotificationCenter.defaultCenter().removeObserver(this),this.fiber&&this.fiber.cleanup&&this.fiber.cleanup()}else log("closeFusionCool: no subviews");else log("closeFusionCool: no webview")},openExportDialog:function(){this.callMainFrameWindowFunction({script:"try {\n      window.FusionCool.openExportDialog();\n    } catch(err) {}"})}};t.default=function(){return i()(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){m(e,t,n[t])})}return e}({},S,f.default))}}.call(this,n("./node_modules/@skpm/timers/timeout.js").setTimeout)},"./src/wkwebview/jsBridge.js":function(e,t){e.exports=function(e){var t=e.isDialog;return"\n  console.log('A2::Inject JSAPI');\n  async function callNative(apiName, apiParam) {\n    if (!(\n      window.webkit &&\n      window.webkit.messageHandlers &&\n      window.webkit.messageHandlers.FusionCoolMessageCenter &&\n      window.webkit.messageHandlers.FusionCoolMessageCenter.postMessage)) {\n        return false;\n    }\n    const random = [\n      +new Date(),\n      parseInt(Math.random()*1000000000, 10),\n    ].join('_');\n    const callbackKey = 'FusionCool_callback_' + random;\n    window.webkit.messageHandlers.FusionCoolMessageCenter.postMessage({\n      name: apiName,\n      param: apiParam,\n      fn: callbackKey,\n    });\n    return await new Promise((resolve) => {\n      window[callbackKey] = (res) => {\n        resolve(res);\n        window[callbackKey] = null;\n        delete window[callbackKey];\n      };\n    });\n  }\n\n  if (!window.callNative) {\n    window.callNative = callNative;\n  }\n  window.__FusionCoolFlags = {\n    isDialog: ".concat(!!t,",\n  };\n  ")}},"./src/wkwebview/message.js":function(e,t,n){var r=n("events");r.prototype.$on=function(e,t){this.listenerCount(e)||this.on(e,t)},r.prototype.$emit=function(e,t){this._events[e]&&this.emit(e,t)};var o=new r;o.messageTypes={MSG_SCRIPT_HANDLER:"message-script-handler",MSG_SCRIPT_HANDLER_DIALOG:"message-script-handler-for-dialog",MSG_EXPORT_ICS_FINISH:"message-export-ics-finish",MSG_EXPORT_ICS_PROGRESS:"message-export-ics-progress",MSG_EXPORT_LOCAL_FINISH:"message-export-local-finish",MSG_EXPORT_DEMOPLUS_FINISH:"message-export-demoplus-finish"},e.exports=o},"./src/wkwebview/messageCenter.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/wkwebview/message.js"),o=n.n(r);t.default={addExportEventListener:function(){var e=this;o.a.$on(o.a.messageTypes.MSG_EXPORT_ICS_FINISH,function(t){var n={type:"onExportIcsFinish",data:t},r="window.onSketchEventTrigger(".concat(JSON.stringify(n),")");e.callMainFrameWindowFunction({script:r})}),o.a.$on(o.a.messageTypes.MSG_EXPORT_ICS_PROGRESS,function(t){var n={type:"onExportIcsProgress",data:t},r="window.onSketchEventTrigger(".concat(JSON.stringify(n),")");e.callMainFrameWindowFunction({script:r,view:e.view})}),o.a.$on(o.a.messageTypes.MSG_EXPORT_LOCAL_FINISH,function(t){var n={type:"onExportLocalFinish",data:t},r="window.onSketchEventTrigger(".concat(JSON.stringify(n),")");e.callMainFrameWindowFunction({script:r})}),o.a.$on(o.a.messageTypes.MSG_EXPORT_DEMOPLUS_FINISH,function(t){var n={type:"onExportDemoPlusFinish",data:t},r="window.onSketchEventTrigger(".concat(JSON.stringify(n),")");e.callMainFrameWindowFunction({script:r})})},callMainFrameWindowFunction:function(e){var t=e.script,n=e.view,r=NSString.stringWithFormat("%@","try {\n      ".concat(t,"\n    } catch (err) { console.error(err);}"));(n||this.view).evaluateJavaScript_completionHandler(r,nil),r=null},removeDialogEvents:function(){o.a.removeAllListeners(o.a.messageTypes.MSG_SCRIPT_HANDLER_DIALOG)}}},"./src/wkwebview/webscript.js":function(e,t,n){"use strict";n.r(t),n.d(t,"WebScriptHandlerClass",function(){return s}),n.d(t,"navigationDelegate",function(){return c});var r=n("./src/wkwebview/message.js"),o=n.n(r),a=n("./src/wkwebview/jsBridge.js"),i=n.n(a),s={"userContentController:didReceiveScriptMessage:":function(e,t){var n=NSJSONSerialization.dataWithJSONObject_options_error(t.body(),0,null),r=NSString.alloc().initWithData_encoding(n,NSUTF8StringEncoding),a=JSON.parse("".concat(r));if(a.param&&"string"==typeof a.param&&/^[{[]/.test(a.param))try{a.param=JSON.parse(a.param)}catch(e){}e.isDialog?o.a.$emit(o.a.messageTypes.MSG_SCRIPT_HANDLER_DIALOG,a):o.a.$emit(o.a.messageTypes.MSG_SCRIPT_HANDLER,a)}},c={"webView:didStartProvisionalNavigation:":function(e){log("1::webView:didStartProvisionalNavigation:");var t=e.configuration().userContentController().isDialog,n=i()({isDialog:t});e.evaluateJavaScript_completionHandler(n,nil)},"webView:didCommitNavigation:":function(e){log("2::webView:didCommitNavigation:");var t=e.configuration().userContentController().isDialog,n=i()({isDialog:t});e.evaluateJavaScript_completionHandler(n,nil)},"webView:didFinishNavigation:":function(e){log("3::webView:didFinishNavigation:");var t=e.configuration().userContentController().isDialog,n=i()({isDialog:t});e.evaluateJavaScript_completionHandler(n,nil)},"webView:didReceiveServerRedirectForProvisionalNavigation:":function(e){log("4::webView:didReceiveServerRedirectForProvisionalNavigation:");var t=e.configuration().userContentController().isDialog,n=i()({isDialog:t});e.evaluateJavaScript_completionHandler(n,nil)},"webViewWebContentProcessDidTerminate:":function(){log("5::wkwebview 进程终止")}}},"./src/wkwebview/webview.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/cocoascript-class/lib/index.js"),o=n.n(r),a=n("./src/config.js"),i=n("./src/wkwebview/webscript.js"),s=n("./src/wkwebview/message.js"),c=n.n(s);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var u=a.default.JSBRIDGE_NAME;t.default=function(e,t){var n=WKWebViewConfiguration.alloc().init(),r=o()(i.WebScriptHandlerClass).new(),a=o()(i.navigationDelegate).new();n.preferences().setValue_forKey(1,"developerExtrasEnabled");var s=WKWebView.alloc().initWithFrame_configuration(CGRectMake(0,0,300,600),n);s.setValue_forKey(!1,"drawsBackground"),s.navigationDelegate=a;var p=t?c.a.messageTypes.MSG_SCRIPT_HANDLER_DIALOG:c.a.messageTypes.MSG_SCRIPT_HANDLER;return c.a.$on(p,function(t){var n;switch(l(n=e[t.name]?t.param?e[t.name](t.param):e[t.name]():"[ERROR] API Not Found: ".concat(t.name))){case"undefined":n="";break;case"string":case"object":n=JSON.stringify(n)}var r=NSString.stringWithFormat("window.%@(%@)",t.fn,n);r="try { ".concat(r,"; } catch(err) { console.error(err); }"),s.evaluateJavaScript_completionHandler(r,nil)}),s.configuration().userContentController().addScriptMessageHandler_name(r,u),s.configuration().userContentController().isDialog=t,s}},events:function(e,t){e.exports=require("events")},sketch:function(e,t){e.exports=require("sketch")}});"default"===key&&"function"==typeof exports?exports(context):exports[key](context)}that.onSelectionChangedFinish=__skpm_run.bind(this,"onSelectionChangedFinish"),that.onCloseDocument=__skpm_run.bind(this,"onCloseDocument"),that.onOpenDocument=__skpm_run.bind(this,"onOpenDocument"),that.onStartup=__skpm_run.bind(this,"onStartup"),that.onShutdown=__skpm_run.bind(this,"onShutdown"),that.onRun=__skpm_run.bind(this,"default"),that.onDebug=__skpm_run.bind(this,"onDebug");